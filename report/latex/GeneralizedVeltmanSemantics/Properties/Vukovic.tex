\begin{spverbatim}
module GeneralizedVeltmanSemantics.Properties.Vukovic where

open import Function.Equivalence using (_â‡”_; equivalence; module Equivalence)

open import Agda.Builtin.Nat using (Nat; suc; zero)
open import Agda.Builtin.Unit using (âŠ¤; tt)
open import Agda.Primitive using (Level; lzero; lsuc; _âŠ”_)
open import Data.Empty using (âŠ¥; âŠ¥-elim)
open import Function using (_$_)
open import Data.Product renaming (_,_ to _â¸´_)
open import Data.Sum using (_âŠ_; injâ‚; injâ‚‚; [_,_])
open import Function using (_âˆ˜_; const; case_of_; id)
open import Function.Equality using (_âŸ¨$âŸ©_)
open import Relation.Binary using (REL; Rel; Transitive)
open import Relation.Nullary using (yes; no; Â¬_)
open import Relation.Unary using (Pred; _âˆˆ_; _âˆ‰_; Decidable; Satisfiable; _âŠ†_; _âˆ©_; ï½›_ï½; âˆ…)
open import Relation.Binary using () renaming (Decidable to Decidableâ‚‚)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl; subst; trans; sym; substâ‚‚; _â‰¢_)

open import Formula using (Fm; Var; _â†_; âŠ¥'; _â–·_; _â—_; var; âŠ¤'; Â¬'_; â–¡_; â™¢_; _âˆ§_; _âˆ¨_; car)
open import Base
open import GeneralizedVeltmanSemantics.Properties using (module SemanticsProperties-4; module SemanticsProperties-L; module PGeneric)
open import GeneralizedFrame
open import GeneralizedFrame.Properties
import OrdinaryFrame as O
import OrdinaryVeltmanSemantics as O
import OrdinaryVeltmanSemantics.Properties as O

private
  variable
    â„“W â„“R â„“S : Level

module OrdModel
  {â„“W â„“R â„“S}
  (T : âˆ€ {â„“W â„“S} â†’ (W : Set â„“W) â†’ RELâ‚ƒ W W (Pred W â„“W) â„“S â†’ Set (lsuc â„“W âŠ” â„“S))
  {W R S}
  (F : Frame {â„“W} {â„“R} {â„“S} W R S T)
  (V : W â†’ Pred Var lzero)
  where
  open Frame F
  open PGeneric T

  W' : Set (lsuc (lsuc â„“W âŠ” â„“R âŠ” â„“S))
  W' =   âˆƒ[ v ]
       (Î£[ A âˆˆ (Pred (W Ã— W) (lsuc â„“W âŠ” â„“S âŠ” â„“R)) ]
       ((âˆ€ {x V} â†’ S x v V â†’ Î£[ V' âˆˆ ğ• ]
         (âˆƒ[ y ] (y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ A)))
       Ã— (âˆ€ {x y} â†’ (x â¸´ y) âˆˆ A â†’ âˆƒ[ V ] (S x v V Ã— y âˆˆ V))
       Ã— (âˆ€ {u} â†’ R u v â†’ (u â¸´ v) âˆˆ A)))

  R' : Rel W' (lsuc â„“W âŠ” â„“R âŠ” â„“S)
  R' (w â¸´ A â¸´ _) (u â¸´ B â¸´ _) = R w u Ã— (âˆ€ {x} â†’ R x w â†’ âˆ€ {y} â†’ (x â¸´ y) âˆˆ B â†’ (x â¸´ y) âˆˆ A)

  S' : Relâ‚ƒ W' (lsuc â„“W âŠ” â„“R âŠ” â„“S)
  S' w'@(w â¸´ A â¸´ _) u'@(u â¸´ B â¸´ _) v'@(v â¸´ C â¸´ _) =
    R' w' u' Ã— R' w' v' Ã— (âˆ€ {y} â†’ (w â¸´ y) âˆˆ C â†’ (w â¸´ y) âˆˆ B)

  module W' where
    v : W' â†’ W
    v = projâ‚

    A : W' â†’ Pred (W Ã— W) _
    A = projâ‚ âˆ˜ projâ‚‚

    p1 : (w' : W')
      â†’ âˆ€ {x V} â†’ S x (v w') V
      â†’ âˆƒ[ V' ] (âˆƒ[ y ]
      (y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ A w'))
    p1 = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚

    p2 : (w' : W') â†’ âˆ€ {x y} â†’ (x â¸´ y) âˆˆ A w'
      â†’ Î£ ğ• Î» V â†’ S x (v w') V Ã— y âˆˆ V
    p2 = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚

    p3 : (w' : W') â†’ âˆ€ {x} â†’ R x (v w') â†’ (x â¸´ v w') âˆˆ A w'
    p3 = projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚

  Amax : W â†’ Pred (W Ã— W) (lsuc â„“W âŠ” â„“S âŠ” â„“R)
  Amax w (x â¸´ y) = Î£ ğ• (Î» V â†’ S x w V Ã— V y Ã— (âŠ¥ â†’ R x x))

  fmax : W â†’ W'
  fmax w = w â¸´ Amax w â¸´
       (Î» { {x} {V} SxwV â†’ V â¸´ (projâ‚ (Swu-sat SxwV) â¸´ (projâ‚‚ (Swu-sat SxwV)
         â¸´ ((Î» {âˆˆV â†’ SwuYâŠ†Rw SxwV âˆˆV}) â¸´ ((Î» z â†’ z) â¸´ (_ â¸´ SxwV
         â¸´ projâ‚‚ (Swu-sat SxwV) â¸´ âŠ¥-elim)))))})
    â¸´ (Î» {(a â¸´ b â¸´ c â¸´ _) â†’ a â¸´ b â¸´ c})
    â¸´ Î» { Ruw â†’ _ â¸´ S-quasirefl Ruw â¸´ refl â¸´ âŠ¥-elim}

  Val' : W' â†’ Pred Var lzero
  Val' w' v = v âˆˆ V (W'.v w')

  f-chain : âˆ€ {a} â†’ InfiniteChain R' a â†’ InfiniteChain R _
  InfiniteChain.b (f-chain x) = W'.v (InfiniteChain.b x)
  InfiniteChain.a<b (f-chain x) = projâ‚ (InfiniteChain.a<b x)
  InfiniteChain.tail (f-chain x) = f-chain (InfiniteChain.tail x)

  R'-Noetherian : Noetherian R'
  R'-Noetherian i = R-noetherian (f-chain i)

  F' : O.Frame W' R' S'
  F' = O.frame
    (fmax witness)
    (Î» { (Rab â¸´ p1) (Rbc â¸´ p2) â†’ (R-trans Rab Rbc) â¸´
      (Î» {Rxi z â†’ p1 Rxi (p2 (R-trans Rxi Rab) z) })})
    R'-Noetherian
    (Î» { (R'wu â¸´ R'wv â¸´ _) â†’ R'wu â¸´ R'wv})
    (Î» {R'wu â†’ R'wu â¸´ R'wu â¸´ (Î» {x â†’ x})})
    (Î» { (a â¸´ (pij â¸´ b)) ((_ â¸´ rjk) â¸´ (c â¸´ pjk)) â†’ a â¸´ c
      â¸´ Î» {x â†’ b (pjk x)}})
    Î» {R'wu@(Rwu â¸´ pwu) R'uv@(Ruv â¸´ puv) â†’ R'wu â¸´ (R-trans Rwu Ruv â¸´
      Î» { {b} Rbw byâˆˆ â†’ pwu Rbw (puv (R-trans Rbw Rwu) byâˆˆ)})
    â¸´ Î» {x â†’ puv Rwu x}}

  M' : O.Model W' R' S' Val'
  M' = O.model F'

module PrefaceTheoremAll
  {â„“W â„“R â„“S}
  {W R S}
  (F : FrameL {â„“W} {â„“R} {â„“S} W R S)
  (V : W â†’ Pred Var lzero)
  where
  T = Trans-conditions.Trans-L
  open OrdModel T F V
  open Frame F
  open PGeneric T

  M : Model W R S V
  M = model {V = V} F

  module Theorem
    (dec : MultiDecidableModel M)
    (dec' : O.DecidableModel M')
    (R? : Decidableâ‚‚ R)
    (âˆˆS? : Decidableâ‚ƒ S)
    (âˆˆS'? : Decidableâ‚ƒ S')
    (âˆˆSV? : âˆ€ {w u Y} â†’ S w u Y â†’ Decidable Y)
    (_â‰¡?_ : Decidableâ‚‚ (_â‰¡_ {_} {W}))
    (monotone : âˆ€ {w u} {V Z : ğ•} â†’ S w u V â†’ V âŠ† Z â†’ Z âŠ† R w â†’ S w u Z)
    (quasitrans : Trans-conditions.Trans-L W S)
    where

    private
      open Extended dec âˆˆS? âˆˆSV?
      module O' = O.Extended dec' âˆˆS'?

      thmâ‡¨ : âˆ€ {w C A} â†’ M , w âŠ© A â†’ M' O., w â¸´ C âŠ© A
      thmâ‡¦ : âˆ€ {w C A} â†’ M' O., w â¸´ C âŠ© A â†’ M , w âŠ© A
      thm'â‡¨ : âˆ€ {w C A} â†’ M , w âŠ® A â†’ M' O., w â¸´ C âŠ® A

      thmâ‡¦ x = âŠ©â‡”Â¬âŠ® â‡ Î» {y â†’ O.âŠ®â†’Â¬âŠ© (thm'â‡¨ y) x}

      module F
        (V0 V : ğ•)
        (v0 u w : W)
        (v0âˆˆV0 : v0 âˆˆ V0)
        (SwuV0 : S w u V0)
        (Swv0V : S w v0 V)
        where
        f : âˆ€ {v} â†’ v âˆˆ V0 â†’ Î£ _ Î» Vv â†’ S w v Vv
        f {v} vâˆˆV0 with v â‰¡? v0
        ... | (yes refl) = V â¸´ Swv0V
        ... | (no n) = ï½› v ï½ â¸´ S-quasirefl (SwuYâŠ†Rw SwuV0 vâˆˆV0)

        fâ‰¡v0 : âˆ€ {v} â†’ v âˆˆ V â†’ v âˆˆ projâ‚ (f v0âˆˆV0)
        fâ‰¡v0 {v} vâˆˆV with v0 â‰¡? v0
        ... | yes refl = vâˆˆV
        ... | no n = âŠ¥-elim (n refl)

      -- thmâ‡¨ = {!!}
      thmâ‡¨ (var x) = O.var x
      thmâ‡¨ A@(impl _) = O'.âŠ©â† â‡ Î» {wA â†’ thmâ‡¨ ((âŠ©â† â‡’ A) (thmâ‡¦ wA))}
      thmâ‡¨ {w} {A'@(A â¸´ Ap1 â¸´ Ap2 â¸´ Ap3)} Dâ–·E@(rhd {D} {E} xl) = O'.âŠ©â–· â‡
        Î» { {ğ”¹@(u â¸´ B â¸´ _)} R'wu@(Rwu â¸´ Rwuâˆˆ) uâŠ©D
          â†’ case (âŠ©â–· â‡’ Dâ–·E) Rwu (thmâ‡¦ uâŠ©D) of
          Î» { (V0 â¸´ SwuV0 â¸´ V0âŠ©E) â†’
        let v0 = projâ‚ (Swu-sat SwuV0)
            v0âˆˆV0 = projâ‚‚ (Swu-sat SwuV0)
            ğ”¸ = w â¸´ A'
            C : Pred (W Ã— W) (lsuc â„“W âŠ” â„“S âŠ” â„“R)
            C = Î» { (x â¸´ y) â†’
              (y â‰¡ v0 Ã— R x v0) âŠ
              (w â‰¡ x Ã— (w â¸´ y) âˆˆ B Ã— Î£ _ Î» V' â†’ S x v0 V' Ã— y âˆˆ V') âŠ
              (Â¬ (R x w) Ã— w â‰¢ x Ã— Î£ _ Î» V' â†’ S x v0 V' Ã— y âˆˆ V') âŠ
              R x w Ã— (x â¸´ y) âˆˆ A Ã— Î£ _ Î» V' â†’ S x v0 V' Ã— y âˆˆ V'}
            V0-v = V0 âˆ© Î» x â†’ x â‰¢ v0
            â„‚ : W'
            â„‚ = v0 â¸´ C
              â¸´ (Î» {x} {V} Sxv0V â†’
              let
                case-wâ‰¡x : w â‰¡ x â†’ Î£ ğ• Î» V' â†’ Î£ _ Î» y â†’
                  y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ C
                case-wâ‰¡x = Î» {refl â†’
                  let
                    open F V0 V v0 u w v0âˆˆV0 SwuV0 Sxv0V
                    SwuVâˆªV0-v0 = quasitrans SwuV0 f
                    pB = W'.p1 ğ”¹ SwuVâˆªV0-v0
                    V' = projâ‚ pB
                    y = projâ‚ âˆ˜ projâ‚‚ $ pB
                    yâˆˆV' : y âˆˆ V'
                    yâˆˆV' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ pB
                    V'âŠ†Rx : V' âŠ† R x
                    V'âŠ†Rx = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ pB
                    VâˆªV0-v0âŠ†V' : _ âŠ† V'
                    VâˆªV0-v0âŠ†V' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ pB
                    wyâˆˆB : (w â¸´ y) âˆˆ B
                    wyâˆˆB = projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ pB
                    pB2 = W'.p2 ğ”¹ wyâˆˆB
                    VâŠ†V' : V âŠ† V'
                    VâŠ†V' = Î» {âˆˆV â†’ VâˆªV0-v0âŠ†V' (v0 â¸´ v0âˆˆV0 â¸´ fâ‰¡v0 âˆˆV)}
                    Swv0â‹ƒ : S w v0 _
                    Swv0â‹ƒ = monotone Sxv0V (Î» { {v} vâˆˆV â†’ v0 â¸´ v0âˆˆV0 â¸´ fâ‰¡v0 vâˆˆV})
                      Î» {z â†’ V'âŠ†Rx (VâˆªV0-v0âŠ†V' z)}
                    Swv0V' : S w v0 V'
                    Swv0V' = monotone Swv0â‹ƒ VâˆªV0-v0âŠ†V' V'âŠ†Rx
                    wyâˆˆC : (w â¸´ y) âˆˆ C
                    wyâˆˆC = injâ‚‚ (injâ‚ (refl â¸´ wyâˆˆB â¸´ _ â¸´ Swv0V' â¸´ yâˆˆV'))
                  in V' â¸´ y â¸´ yâˆˆV' â¸´ V'âŠ†Rx â¸´ VâŠ†V' â¸´ wyâˆˆC}
                case-wâ‰ x : w â‰¢ x â†’ Â¬ R x w â†’ Î£ ğ• Î» V' â†’ Î£ _ Î» y â†’
                  y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ C
                case-wâ‰ x = Î» {wâ‰ x Â¬Rwx â†’
                  let
                    VâŠ†C : V âŠ† Î» {y â†’ (x â¸´ y) âˆˆ C}
                    VâŠ†C = Î» { {y} yâˆˆV â†’ injâ‚‚ (injâ‚‚ (injâ‚
                      (Â¬Rwx â¸´ (wâ‰ x â¸´ V â¸´ Sxv0V â¸´ yâˆˆV))))}
                    yâˆˆV = projâ‚‚ $ Swu-sat Sxv0V
                  in V â¸´ _ â¸´ yâˆˆV â¸´ SwuYâŠ†Rw Sxv0V â¸´ (Î» i â†’ i) â¸´ VâŠ†C yâˆˆV}
                case-Rxw : R x w â†’ Î£ ğ• Î» V' â†’ Î£ _ Î» y â†’
                  y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ C
                case-Rxw = Î» { Rxw â†’
                  let
                    Rwv0 = SwuYâŠ†Rw SwuV0 v0âˆˆV0
                    Sxwv0 : S x w ï½› v0 ï½
                    Sxwv0 = R-Sw-trans Rxw Rwv0
                    SwxV : S x w V
                    SwxV = S-ext (quasitrans Sxwv0 Î» {refl â†’ _ â¸´ Sxv0V})
                      (Î» { (_ â¸´ refl â¸´ p) â†’ p})
                      Î» {vâˆˆV â†’ v0 â¸´ refl â¸´ vâˆˆV}
                    p = W'.p1 ğ”¸ SwxV
                    V' = projâ‚ p
                    yâˆˆV' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
                    V'âŠ†Rx = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
                    VâŠ†V' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
                    xyâˆˆA : (x â¸´ _) âˆˆ A
                    xyâˆˆA = projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
                    SxwV' : S x v0 V'
                    SxwV' = monotone Sxv0V VâŠ†V' V'âŠ†Rx
                  in V' â¸´ _ â¸´ yâˆˆV' â¸´ V'âŠ†Rx â¸´ VâŠ†V'
                    â¸´ injâ‚‚ (injâ‚‚ (injâ‚‚ (Rxw â¸´ xyâˆˆA â¸´ (_ â¸´ (SxwV' â¸´ yâˆˆV')))))}
              in
              case w â‰¡? x â¸´ R? x w of
                Î» { (yes refl â¸´ _) â†’ case-wâ‰¡x refl
                ; (no wâ‰ x â¸´ no Â¬Rxw) â†’ case-wâ‰ x wâ‰ x Â¬Rxw
                ; (no wâ‰ x â¸´ yes Rxw) â†’ case-Rxw Rxw } )
              â¸´ (Î» { (injâ‚ (refl â¸´ Rxv0)) â†’ _ â¸´ S-quasirefl Rxv0 â¸´ refl ;
                (injâ‚‚ (injâ‚ (refl â¸´ wyâˆˆ â¸´ V â¸´ Sxv0V â¸´ âˆˆV))) â†’ _ â¸´ Sxv0V â¸´ âˆˆV ;
                (injâ‚‚ (injâ‚‚ (injâ‚ (Â¬Rxw â¸´ wâ‰ x â¸´ V â¸´ Sxv0V â¸´ âˆˆV)))) â†’ _ â¸´ Sxv0V â¸´ âˆˆV ;
                (injâ‚‚ (injâ‚‚ (injâ‚‚ (Rxw â¸´ âˆˆA â¸´ V â¸´ Sxv0V â¸´ âˆˆV)))) â†’ _ â¸´ Sxv0V â¸´ âˆˆV})
              â¸´ Î» { Rxv0 â†’ injâ‚ (refl â¸´ Rxv0)}
            Rwv0 : R w v0
            Rwv0 = SwuYâŠ†Rw SwuV0 v0âˆˆV0
            Câ†’A : âˆ€ {x y} â†’ R x w â†’ (x â¸´ y) âˆˆ C â†’ (x â¸´ y) âˆˆ A
            Câ†’A = Î» { {x} {y} Rxw xyâˆˆC@(injâ‚ (refl â¸´ Rxv0))
                â†’ case W'.p2 â„‚ xyâˆˆC of Î» { (V â¸´ SV â¸´ âˆˆV) â†’ {!Ap3!}} ;
              Rxw (injâ‚‚ (injâ‚ (refl â¸´ wyâˆˆB â¸´ _))) â†’ âŠ¥-elim (R-Irreflexive {F = F} refl Rxw) ;
              Rxw (injâ‚‚ (injâ‚‚ (injâ‚ x))) â†’ âŠ¥-elim (projâ‚ x Rxw) ;
              Rxw (injâ‚‚ (injâ‚‚ (injâ‚‚ (_ â¸´ xyâˆˆA â¸´ _)))) â†’ xyâˆˆA }
            wv0âˆˆB : (w â¸´ v0) âˆˆ B
            wv0âˆˆB = {!!}
            Câ†’B : âˆ€ {y} â†’ (w â¸´ y) âˆˆ C â†’ (w â¸´ y) âˆˆ B
            Câ†’B = Î» { {y} xyâˆˆC@(injâ‚ (refl â¸´ Rwv0)) â†’ wv0âˆˆB ;
              (injâ‚‚ (injâ‚ (refl â¸´ wyâˆˆB â¸´ _))) â†’ wyâˆˆB ;
              (injâ‚‚ (injâ‚‚ (injâ‚ (_ â¸´ wâ‰ w â¸´ _)))) â†’ âŠ¥-elim (wâ‰ w refl) ;
              (injâ‚‚ (injâ‚‚ (injâ‚‚ (Rww â¸´ _)))) â†’ âŠ¥-elim (R-Irreflexive {F = F} refl Rww) }
            R'AB : R' ğ”¸ ğ”¹
            R'AB = Rwu â¸´ Rwuâˆˆ
            R'AC : R' ğ”¸ â„‚
            R'AC = Rwv0 â¸´ (Î» { {x} Rxw xyâˆˆC â†’ Câ†’A Rxw xyâˆˆC})
        in â„‚ â¸´ ((R'AB â¸´ R'AC â¸´ Î» {x â†’ Câ†’B x}) â¸´ thmâ‡¨ (V0âŠ©E v0âˆˆV0))
           }}

      thm'â‡¨ (var x) = O.var x
      thm'â‡¨ {w} {C} (impl {A} {B} a b) = O.impl (thmâ‡¨ a) (thm'â‡¨ b)
      thm'â‡¨ bot = O.bot
      thm'â‡¨ {w} {A â¸´ Ap1 â¸´ Ap2} DE@(rhd {D} {E} _) = case âŠ®â–· â‡’ DE of
        Î» { (u â¸´ Rwu â¸´ uâŠ©D â¸´ pu) â†’
          let open Aux u Rwu uâŠ©D (Î» {SV â†’ pu _ (Swu-sat SV) SV})
          in O'.âŠ®â–· â‡ (ğ”¹ â¸´ {!!})
        }
        where
        module Aux
          (u : W)
          (Rwu : R w u)
          (uâŠ©D : M , u âŠ© D)
          (pu : âˆ€ {V} â†’ S w u V â†’ Satisfiable (V âˆ© (M ,_âŠ® E)))
          where
          B : Pred (W Ã— W) (lsuc â„“W âŠ” â„“S âŠ” â„“R)
          B (x â¸´ y) =
              (y â‰¡ u Ã— R x u)
            âŠ (w â‰¡ x Ã— M , y âŠ® E Ã— Î£ ğ• Î» V â†’ S w u V Ã— y âˆˆ V)
            âŠ (Â¬ R x w Ã— w â‰¢ x Ã— Î£ ğ• Î» V â†’ S x u V Ã— y âˆˆ V)
            âŠ (R x w Ã— (x â¸´ y) âˆˆ A Ã— Î£ ğ• Î» V â†’ S x u V Ã— y âˆˆ V)
          p2 : âˆ€ {x y} â†’ (x â¸´ y) âˆˆ B â†’ Î£ ğ• Î» V â†’ S x u V Ã— y âˆˆ V
          p2 (injâ‚ (refl â¸´ Rxu)) = _ â¸´ S-quasirefl Rxu â¸´ refl
          p2 (injâ‚‚ (injâ‚ (refl â¸´ yâŠ®E â¸´ V â¸´ SwuV â¸´ yâˆˆV))) = V â¸´ SwuV â¸´ yâˆˆV
          p2 (injâ‚‚ (injâ‚‚ (injâ‚ (Â¬Rxw â¸´ xâ‰ w â¸´ V â¸´ SxuV â¸´ yâˆˆV)))) = V â¸´ SxuV â¸´ yâˆˆV
          p2 (injâ‚‚ (injâ‚‚ (injâ‚‚ (Rxw â¸´ xyâˆˆA â¸´ V â¸´ SxuV â¸´ yâˆˆV)))) = V â¸´ SxuV â¸´ yâˆˆV
          p1 : âˆ€ {x V} â†’ S x u V â†’ Î£ ğ• Î» V' â†’ Î£ W Î» y
            â†’ y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ B
          p1 {x} {V} SxuV with w â‰¡? x
          ... | yes refl = case pu SxuV of
            Î» { (y â¸´ yâˆˆV â¸´ yE) â†’ V â¸´ _ â¸´ yâˆˆV â¸´ (Î» {z â†’ SwuYâŠ†Rw SxuV z }) â¸´ (Î» {z â†’ z})
            â¸´ injâ‚‚ (injâ‚ (refl â¸´ yE â¸´ _ â¸´ SxuV â¸´ yâˆˆV))}
          ... | no wâ‰ x with R? x w
          ... | no Â¬Rxw = V â¸´ _ â¸´ (projâ‚‚ (Swu-sat SxuV) â¸´ (Î» {z â†’ SwuYâŠ†Rw SxuV z })
            â¸´ (Î» {z â†’ z})
            â¸´ (injâ‚‚ (injâ‚‚ (injâ‚ (Â¬Rxw â¸´ (wâ‰ x â¸´ (_ â¸´ (SxuV â¸´ (projâ‚‚ (Swu-sat SxuV))))))))))
          ... | yes Rxw = V' â¸´ y â¸´ yâˆˆV' â¸´ (Î» {z â†’ V'âŠ†Rx z}) â¸´ (Î» {z â†’ VâŠ†V' z})
            â¸´ injâ‚‚ (injâ‚‚ (injâ‚‚ (Rxw â¸´ (xyâˆˆA â¸´ _ â¸´ (SxuV' â¸´ yâˆˆV')))))
            where
            SxwV : S x w V
            SxwV = S-trans Rxw Rwu SxuV
              where open FrameLProperties F
            p : Î£ ğ• Î» V' â†’ Î£ _ Î» y
              â†’ y âˆˆ V' Ã— V' âŠ† R x Ã— V âŠ† V' Ã— (x â¸´ y) âˆˆ A
            p = Ap1 SxwV
            V' = projâ‚ p
            y = projâ‚ âˆ˜ projâ‚‚ $ p
            yâˆˆV' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
            V'âŠ†Rx = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
            VâŠ†V' = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
            xyâˆˆA = projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚ $ p
            SxuV' : S x u V'
            SxuV' = monotone SxuV VâŠ†V' V'âŠ†Rx
          ğ”¹ : W'
          ğ”¹ = u â¸´ B
            â¸´ p1
            â¸´ p2
            â¸´ injâ‚ âˆ˜ (refl â¸´_)
          c0 : âˆ€ {x} â†’ R x w â†’ R x u â†’ (x â¸´ u) âˆˆ A
          c0 Rxw Rxu = case Ap1 (R-Sw-trans Rxw Rwu) of
            Î» { (V' â¸´ y â¸´ yâˆˆV' â¸´ V'âŠ†Rx â¸´ uâŠ†V' â¸´ xyâˆˆA) â†’ {!!}}
          l1 : âˆ€ {x y} â†’ R x w â†’ (x â¸´ y) âˆˆ B â†’ (x â¸´ y) âˆˆ A
          l1 Rxw (injâ‚ (refl â¸´ Rxu)) = c0 Rxw Rxu
          l1 Rxw (injâ‚‚ (injâ‚ (refl â¸´ snd))) = âŠ¥-elim (R-Irreflexive {F = F} refl Rxw)
          l1 Rxw (injâ‚‚ (injâ‚‚ (injâ‚ x))) = âŠ¥-elim (projâ‚ x Rxw)
          l1 Rxw (injâ‚‚ (injâ‚‚ (injâ‚‚ y))) = projâ‚ âˆ˜ projâ‚‚ $ y

    theorem : âˆ€ {w C A} â†’ M , w âŠ© A â‡” M' O., w â¸´ C âŠ© A
    theorem = equivalence thmâ‡¨ thmâ‡¦
\end{spverbatim}
