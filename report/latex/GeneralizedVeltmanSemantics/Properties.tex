\begin{spverbatim}
module GeneralizedVeltmanSemantics.Properties where

open import Function.Equivalence using (_â‡”_; equivalence; module Equivalence)

open import Agda.Builtin.Nat using (Nat; suc; zero)
open import Agda.Builtin.Unit using (âŠ¤; tt)
open import Agda.Primitive using (Level; lzero; lsuc; _âŠ”_)
open import Data.Empty using (âŠ¥; âŠ¥-elim)
open import Data.Product using (Î£; projâ‚; projâ‚‚; _Ã—_) renaming (_,_ to _â¸´_)
open import Data.Sum using (_âŠ_; injâ‚; injâ‚‚; [_,_])
open import Function using (_âˆ˜_; const; case_of_; id)
open import Function.Equality using (_âŸ¨$âŸ©_)
open import Relation.Binary using (REL; Rel; Transitive)
open import Relation.Nullary using (yes; no; Â¬_)
open import Relation.Unary using (Pred; _âˆˆ_; _âˆ‰_; Decidable; Satisfiable; _âŠ†_; _âˆ©_; ï½›_ï½)
open import Relation.Binary using (Irreflexive) renaming (Decidable to Decidableâ‚‚)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; refl)

open import Formula using (Fm; Var; _â†_; âŠ¥'; _â–·_; _â—_; var; âŠ¤'; Â¬'_; â–¡_; â™¢_; _âˆ§_; _âˆ¨_; car)
import GeneralizedVeltmanSemantics as G
open import GeneralizedFrame using (module Trans-conditions)
open import Base
import Principles as P

module PGeneric
  (T : âˆ€ {â„“W â„“S} (W : Set â„“W) â†’ RELâ‚ƒ W W (Pred W â„“W) â„“S â†’ Set (lsuc â„“W âŠ” â„“S))
  where
  open G.Generic T public

  R-Irreflexive : âˆ€ {â„“W â„“R â„“S W R S T} â†’ {F : G.Frame {â„“W} {â„“R} {â„“S} W R S T} â†’ Irreflexive _â‰¡_ R
  R-Irreflexive {F = F} {x} refl Rxx = R-noetherian (infiniteRefl Rxx)
    where open G.Frame F

  module _
    {â„“W â„“R â„“S}
    {W R S V}
    {M : Model {â„“W} {â„“R} {â„“S} W R S V} where
    open Model M
    open G.Frame F

    âŠ©âŠ¥ : âˆ€ {w} â†’ Â¬ (M , w âŠ© âŠ¥')
    âŠ©âŠ¥ = Î» ()

    âŠ®â†’Â¬âŠ© : âˆ€ {w A} â†’ M , w âŠ® A â†’ Â¬ (M , w âŠ© A)
    âŠ®â†’Â¬âŠ© (var x) (var xâ‚) = x xâ‚
    âŠ®â†’Â¬âŠ© (impl x a) (impl (injâ‚ xâ‚)) = âŠ®â†’Â¬âŠ© xâ‚ x
    âŠ®â†’Â¬âŠ© (impl x a) (impl (injâ‚‚ y)) = âŠ®â†’Â¬âŠ© a y
    âŠ®â†’Â¬âŠ© (rhd (u â¸´ Rwu â¸´ fst â¸´ snd)) (rhd z) with z Rwu
    ... | injâ‚ x = âŠ®â†’Â¬âŠ© x fst
    ... | injâ‚‚ (Y â¸´ SwuY â¸´ p)
      = case snd Y (Swu-sat SwuY) of
        Î» { (injâ‚ x) â†’ x SwuY ; (injâ‚‚ (y â¸´ w â¸´ z))
        â†’ âŠ®â†’Â¬âŠ© z (p w)}

    âŠ©â†’Â¬âŠ® : âˆ€ {w A} â†’ M , w âŠ© A â†’ Â¬ (M , w âŠ® A)
    âŠ©â†’Â¬âŠ® x y = âŠ®â†’Â¬âŠ© y x

    âŠ©MP : âˆ€ {w A B} â†’ M , w âŠ© A â† B â†’ M , w âŠ© A â†’ M , w âŠ© B
    âŠ©MP (impl (injâ‚ x)) y = âŠ¥-elim (âŠ©â†’Â¬âŠ® y x)
    âŠ©MP (impl (injâ‚‚ x)) y = x

    âŠ©Â¬ : âˆ€  {w A} â†’ (M , w âŠ© Â¬' A) â‡” (M , w âŠ® A)
    âŠ©Â¬ {w} {A} = equivalence â‡¨ â‡¦
      where â‡¨ : M , w âŠ© Â¬' A â†’ M , w âŠ® A
            â‡¨ (impl (injâ‚ x)) = x
            â‡¦ : M , w âŠ® A â†’ M , w âŠ© Â¬' A
            â‡¦ (var x) = impl (injâ‚ (var x))
            â‡¦ (impl x xâ‚) = impl (injâ‚ (impl x xâ‚))
            â‡¦ (rhd x) = impl (injâ‚ (rhd x))
            â‡¦ bot = impl (injâ‚ bot)

    âŠ©âŠ¤ : âˆ€ {w} â†’ M , w âŠ© âŠ¤'
    âŠ©âŠ¤ = impl (injâ‚ bot)

    âŠ®âŠ¤ : âˆ€ {w} â†’ Â¬ (M , w âŠ® âŠ¤')
    âŠ®âŠ¤ (impl x xâ‚) = âŠ©â†’Â¬âŠ® x xâ‚

    âŠ®Â¬ : âˆ€ {w A} â†’ M , w âŠ® Â¬' A â‡” M , w âŠ© A
    âŠ®Â¬ {w} {A} = equivalence â‡¨ â‡¦
      where
        â‡¨ : M , w âŠ® Â¬' A â†’ M , w âŠ© A
        â‡¨ (impl x xâ‚) = x
        â‡¦ : M , w âŠ© A â†’ M , w âŠ® Â¬' A
        â‡¦ x = impl x bot

    âŠ©Â¬Â¬ : âˆ€ {w A} â†’ M , w âŠ© Â¬' Â¬' A â‡” M , w âŠ© A
    âŠ©Â¬Â¬ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ© Â¬' Â¬' A â†’ M , w âŠ© A
      â‡¨ (impl (injâ‚ (impl x xâ‚))) = x
      â‡¦ : M , w âŠ© A â†’ M , w âŠ© Â¬' Â¬' A
      â‡¦ x = impl (injâ‚ (impl x bot))

    âŠ®Â¬Â¬ : âˆ€  {w A} â†’ M , w âŠ® Â¬' Â¬' A â‡” M , w âŠ® A
    âŠ®Â¬Â¬ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ® Â¬' Â¬' A â†’ M , w âŠ® A
      â‡¨ x = âŠ©Â¬ â‡’ (âŠ®Â¬ â‡’ x)
      â‡¦ : M , w âŠ® A â†’ M , w âŠ® Â¬' Â¬' A
      â‡¦ x = âŠ®Â¬ â‡ (âŠ©Â¬ â‡ x)

    âŠ©âˆ§ : âˆ€ {w A B} â†’ M , w âŠ© A âˆ§ B â‡” (M , w âŠ© A Ã— M , w âŠ© B)
    âŠ©âˆ§ {w} {A} {B} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ© A âˆ§ B â†’ M , w âŠ© A Ã— M , w âŠ© B
      â‡¨ (impl (injâ‚ (impl x (impl xâ‚ y)))) = x â¸´ xâ‚
      â‡¦ : M , w âŠ© A Ã— M , w âŠ© B â†’ M , w âŠ© A âˆ§ B
      â‡¦ (fst â¸´ snd) = impl (injâ‚ (impl fst (impl snd bot)))

    âŠ®âˆ§ : âˆ€ {w A B} â†’ M , w âŠ® A âˆ§ B â‡” (M , w âŠ® A âŠ M , w âŠ® B)
    âŠ®âˆ§ {w} {A} {B} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ® A âˆ§ B â†’ (M , w âŠ® A âŠ M , w âŠ® B)
      â‡¨ (impl (impl (injâ‚ x)) xâ‚) = injâ‚ x
      â‡¨ (impl (impl (injâ‚‚ (impl (injâ‚ x)))) xâ‚) = injâ‚‚ x
      â‡¦ : (M , w âŠ® A âŠ M , w âŠ® B) â†’ M , w âŠ® A âˆ§ B
      â‡¦ (injâ‚ x) = impl (impl (injâ‚ x)) bot
      â‡¦ (injâ‚‚ y) = impl (impl (injâ‚‚ (âŠ©Â¬ â‡ y))) bot

    âŠ©âˆ¨ : âˆ€ {w A B} â†’ M , w âŠ© A âˆ¨ B â‡” (M , w âŠ© A âŠ M , w âŠ© B)
    âŠ©âˆ¨ {w} {A} {B} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ© A âˆ¨ B â†’ (M , w âŠ© A âŠ M , w âŠ© B)
      â‡¨ (impl (injâ‚ (impl x xâ‚))) = injâ‚ x
      â‡¨ (impl (injâ‚‚ y)) = injâ‚‚ y
      â‡¦ : (M , w âŠ© A âŠ M , w âŠ© B) â†’ M , w âŠ© A âˆ¨ B
      â‡¦ (injâ‚ x) = impl (injâ‚ (âŠ®Â¬ â‡ x))
      â‡¦ (injâ‚‚ y) = impl (injâ‚‚ y)

    âŠ©â–¡ : âˆ€ {w A} â†’ M , w âŠ© â–¡ A â‡” (âˆ€ {v} â†’ R w v â†’ M , v âŠ© A)
    âŠ©â–¡ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ© â–¡ A â†’ (âˆ€ {v} â†’ R w v â†’ M , v âŠ© A)
      â‡¨ (rhd f) wRv with f wRv
      ... | (injâ‚ x) = âŠ®Â¬ â‡’ x
      ... | injâ‚‚ (Y â¸´ SwvY â¸´ x) = case Swu-sat SwvY of
        Î» { (u â¸´ snd) â†’ âŠ¥-elim (âŠ©âŠ¥ (x snd)) }
      â‡¦ : (âˆ€ {v} â†’ R w v â†’ M , v âŠ© A) â†’ M , w âŠ© â–¡ A
      â‡¦ x = rhd Î» wRu â†’ injâ‚ (âŠ®Â¬ â‡ (x wRu))

    âŠ®â–¡ : âˆ€ {w A} â†’ M , w âŠ® â–¡ A â‡” (Î£ (W) Î» u â†’ R w u Ã— M , u âŠ® A)
    âŠ®â–¡ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ® â–¡ A â†’ (Î£ (W) Î» u â†’ R w u Ã— M , u âŠ® A)
      â‡¨ (rhd (u â¸´ wRu â¸´ uâŠ©Â¬A â¸´ snd)) = u â¸´ wRu â¸´ âŠ©Â¬ â‡’ uâŠ©Â¬A
      â‡¦ : (Î£ W Î» u â†’ R w u Ã— M , u âŠ® A) â†’ M , w âŠ® â–¡ A
      â‡¦ (u â¸´ wRu â¸´ uâŠ®A) = rhd (u â¸´ (wRu â¸´ âŠ©Â¬ â‡ uâŠ®A
        â¸´ Î» { Y (v â¸´ p) â†’ injâ‚‚ (v â¸´ p â¸´ bot)}))

    âŠ©â™¢ : âˆ€  {w A} â†’ M , w âŠ© â™¢ A â‡” (Î£ (W) Î» u â†’ R w u Ã— M , u âŠ© A)
    âŠ©â™¢ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ© â™¢ A â†’ Î£ W Î» u â†’ R w u Ã— M , u âŠ© A
      â‡¨ (impl (injâ‚ (rhd (u â¸´ m â¸´ uâŠ©Â¬Â¬A â¸´ snd)))) = u â¸´ m â¸´ âŠ©Â¬Â¬ â‡’ uâŠ©Â¬Â¬A
      â‡¦ : (Î£ W Î» u â†’ R w u Ã— M , u âŠ© A) â†’ M , w âŠ© â™¢ A
      â‡¦ (u â¸´ wRu â¸´ snd) = impl (injâ‚ (rhd (u â¸´ (wRu â¸´ âŠ©Â¬Â¬ â‡ snd â¸´ Î» _ s â†’ injâ‚‚ (projâ‚ s â¸´ projâ‚‚ s â¸´ bot)))))

    âŠ®â™¢ : âˆ€ {w A} â†’ M , w âŠ® â™¢ A â‡” (âˆ€ {u} â†’ R w u â†’ M , u âŠ® A)
    âŠ®â™¢ {w} {A} = equivalence â‡¨ â‡¦
      where
      â‡¨ : M , w âŠ® â™¢ A â†’ (âˆ€ {u} â†’ R w u â†’ M , u âŠ® A)
      â‡¨ (impl (rhd x) y) wRu with x wRu
      ... | injâ‚ z = âŠ®Â¬Â¬ â‡’ z
      ... | injâ‚‚ (Y â¸´ z â¸´ k) = âŠ¥-elim (âŠ©âŠ¥ (k (projâ‚‚ (Swu-sat z))))
      â‡¦ : (âˆ€ {u} â†’ R w u â†’ M , u âŠ® A) â†’ M , w âŠ® â™¢ A
      â‡¦ x = impl (rhd (Î» wRu â†’ injâ‚ (âŠ®Â¬Â¬ â‡ (x wRu)))) bot

    âŠ©4' : âˆ€ {w A} â†’ M , w âŠ© â–¡ A â†’ M , w âŠ© â–¡ â–¡ A
    âŠ©4' (rhd x) = âŠ©â–¡ â‡ Î» {u} wRu â†’ rhd (Î» {v} uRv â†’
      case x {v} (R-trans wRu uRv) of Î» { (injâ‚ x) â†’ injâ‚ x
        ; (injâ‚‚ (Y â¸´ SY â¸´ snd)) â†’ âŠ¥-elim (âŠ©âŠ¥ (snd (projâ‚‚ (Swu-sat SY))))})

    âŠ©â†â‡¨ : âˆ€ {w A B} â†’ M , w âŠ© A â† B â†’ (M , w âŠ© A â†’ M , w âŠ© B)
    âŠ©â†â‡¨ (impl (injâ‚ x)) y = âŠ¥-elim (âŠ®â†’Â¬âŠ© x y)
    âŠ©â†â‡¨ (impl (injâ‚‚ b)) y = b

    module Extended
      (M,_*âŠ©?_ : MultiDecidableModel M)
      (âˆˆS? : Decidableâ‚ƒ S)
      (âˆˆSV? : âˆ€ {w u Y} â†’ S w u Y â†’ Decidable Y) where

      infix 5 M,_âŠ©?_
      M,_âŠ©?_ : DecidableModel M
      M,_âŠ©?_ = SingleDecidableModel M,_*âŠ©?_

      open Model M

      [âŠ©_] : Fm â†’ ğ•
      [âŠ© A ] y with M, y âŠ©? A
      ... | injâ‚ p = âŠ¤ Ã— (âŠ¥ â†’ W)
      ... | injâ‚‚ p = âŠ¥ Ã— (âŠ¥ â†’ W)

      âˆˆ[âŠ©_] : âˆ€ {y} A â†’ y âˆˆ [âŠ© A ] â‡” M , y âŠ© A
      âˆˆ[âŠ©_] {y} A = equivalence â‡¨ â‡¦
        where
        â‡¨ : y âˆˆ [âŠ© A ] â†’ M , y âŠ© A
        â‡¨ x with M, y âŠ©? A
        ... | injâ‚ k = k
        â‡¦ : M , y âŠ© A â†’ y âˆˆ [âŠ© A ]
        â‡¦ fst with M, y âŠ©? A
        ... | injâ‚ x = tt â¸´ Î» ()
        ... | injâ‚‚ y = âŠ©â†’Â¬âŠ® fst y â¸´ Î» ()

      âŠ©â† : âˆ€ {w A B} â†’ M , w âŠ© A â† B â‡” (M , w âŠ© A â†’ M , w âŠ© B)
      âŠ©â† {w} {A} {B} = equivalence âŠ©â†â‡¨ â‡¦
        where
        â‡¦ : (M , w âŠ© A â†’ M , w âŠ© B) â†’ M , w âŠ© A â† B
        â‡¦ x with M, w âŠ©? A
        ... | injâ‚ z = impl (injâ‚‚ (x z))
        ... | injâ‚‚ y = impl (injâ‚ y)

      -- âŠ®â† : âˆ€ {w A B} â†’ M , w âŠ® A â† B â‡” (M , w âŠ© A Ã— M , w âŠ® B)
      -- âŠ®â† {w} {A} {B} = equivalence â‡¨ â‡¦
      --   where
      --   â‡¨ : M , w âŠ® A â† B â†’ (M , w âŠ© A Ã— M , w âŠ® B)
      --   â‡¨ x = {!!}
      --   â‡¦ : (M , w âŠ© A Ã— M , w âŠ® B) â†’ M , w âŠ® A â† B
      --   â‡¦ = {!!}

      âŠ©â–· : âˆ€ {w A B} â†’ M , w âŠ© A â–· B â‡”
        (âˆ€ {u} â†’ R w u â†’ M , u âŠ© A â†’ Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† M ,_âŠ© B)
      âŠ©â–· {w} {A} {B} = equivalence â‡¨ â‡¦
        where
        â‡¨ : M , w âŠ© A â–· B â†’ (âˆ€ {u} â†’ R w u â†’ M , u âŠ© A
          â†’ Î£ ğ• Î» Y
          â†’ S w u Y Ã— Y âŠ† M ,_âŠ© B)
        â‡¨ (rhd x) {u} wRu uA with x wRu
        â‡¨ (rhd x) {u} wRu uA | injâ‚ z = âŠ¥-elim (âŠ©â†’Â¬âŠ® uA z)
        â‡¨ (rhd x) {u} wRu uA | injâ‚‚ (fst â¸´ fstâ‚ â¸´ snd) = fst â¸´ (fstâ‚ â¸´ snd)
        â‡¦ : (âˆ€ {u} â†’ R w u â†’ M , u âŠ© A â†’ Î£ ğ• Î» Y â†’ S w u Y
          Ã— Y âŠ† M ,_âŠ© B) â†’ M , w âŠ© A â–· B
        â‡¦ x = rhd (Î» {u} wRu â†’ [ (Î» xâ‚ â†’ injâ‚‚ (x wRu xâ‚)) , injâ‚ ] (M, u âŠ©? A))

      âŠ®â–· : âˆ€ {w A B} â†’ M , w âŠ® A â–· B â‡”
        Î£ W (Î» u â†’ R w u Ã— M , u âŠ© A Ã— âˆ€ Y â†’ Satisfiable Y â†’ S w u Y â†’ (Satisfiable (Y âˆ© (M ,_âŠ® B))))
      âŠ®â–· {w} {A} {B} = equivalence â‡¨ â‡¦
        where
        â‡¨ : M , w âŠ® A â–· B â†’ Î£ W (Î» u â†’ R w u Ã— M , u âŠ© A Ã— ((Y : ğ•) â†’
              Satisfiable Y â†’ S w u Y â†’ Satisfiable (Y âˆ© (M ,_âŠ® B))))
        â‡¨ (rhd (u â¸´ Rwu â¸´ uA â¸´ snd)) = u â¸´ Rwu â¸´ uA â¸´ (Î» {Y x xâ‚ â†’ case snd Y x of
          Î» { (injâ‚ x) â†’ âŠ¥-elim (x xâ‚) ; (injâ‚‚ y) â†’ y}})
        â‡¦ : Î£ W (Î» u â†’ R w u Ã— M , u âŠ© A Ã— ((Y : ğ•) â†’
              Satisfiable Y â†’ S w u Y â†’ Satisfiable (Y âˆ© (M ,_âŠ® B)))) â†’
          M , w âŠ® A â–· B
        â‡¦ (u â¸´ Rwu â¸´ uA â¸´ snd) = rhd (u â¸´ Rwu â¸´ uA â¸´ Î» Y x â†’ case âˆˆS? w u Y of
          Î» { (yes p) â†’ injâ‚‚ (snd Y x p) ; (no p) â†’ injâ‚ p})

      âŠ©â— : âˆ€ {w A B} â†’ M , w âŠ© A â— B â‡” Î£ W Î» x â†’ R w x Ã— M , x âŠ© A Ã— âˆ€ {V} â†’ S w x V â†’ Î£ W Î» b â†’ b âˆˆ V Ã— M , b âŠ© B
      âŠ©â— {w} {A} {B} = equivalence â‡¨ â‡¦
        where
        â‡¨ : M , w âŠ© A â— B â†’ Î£ W Î» x â†’ R w x Ã— M , x âŠ© A Ã— âˆ€ {V} â†’ S w x V â†’ Î£ W Î» b â†’ b âˆˆ V Ã— M , b âŠ© B
        â‡¨ Aâ—B = case âŠ©Â¬ â‡’ Aâ—B of Î» {z â†’ case âŠ®â–· â‡’ z of
          Î» { (u â¸´ Rwu â¸´ uA â¸´ snd) â†’ u â¸´ Rwu â¸´ uA â¸´ Î» {V} SwuV â†’ case snd V (Swu-sat SwuV) SwuV of
          Î» { (b â¸´ fst â¸´ snd) â†’ b â¸´ (fst â¸´ (âŠ®Â¬ â‡’ snd)) }}}
        â‡¦ : (Î£ W Î» x â†’ R w x Ã— M , x âŠ© A Ã— âˆ€ {V} â†’ S w x V â†’ Î£ W Î» b â†’ b âˆˆ V Ã— M , b âŠ© B) â†’ M , w âŠ© A â— B
        â‡¦ (u â¸´ Rwu â¸´ uA â¸´ p) = âŠ©Â¬ â‡ (âŠ®â–· â‡ (u â¸´ Rwu â¸´ uA â¸´ (Î» Y satY SwuY â†’ case p SwuY of
          Î» { (y â¸´ yâˆˆY â¸´ yB) â†’ y â¸´ (yâˆˆY â¸´ âŠ®Â¬ â‡ yB)})))

      âŠ©4 : âˆ€ {w A} â†’ M , w âŠ© â–¡ A â† â–¡ â–¡ A
      âŠ©4 = âŠ©â† â‡ âŠ©4'

      âŠ©â‡”Â¬âŠ® : âˆ€ {w A} â†’ M , w âŠ© A â‡” (Â¬ M , w âŠ® A)
      âŠ©â‡”Â¬âŠ® {w} {A} = equivalence âŠ©â†’Â¬âŠ® â‡¦
        where
        â‡¦ : (M , w âŠ® A â†’ âŠ¥) â†’ M , w âŠ© A
        â‡¦ x = [ id , (Î» y â†’ âŠ¥-elim (x y)) ] (M, w âŠ©? A)

      âŠ®â‡”Â¬âŠ© : âˆ€ {w A} â†’ M , w âŠ® A â‡” (Â¬ M , w âŠ© A)
      âŠ®â‡”Â¬âŠ© {w} {A} = equivalence âŠ®â†’Â¬âŠ© â‡¦
        where
        â‡¦ : Â¬ M , w âŠ© A â†’ M , w âŠ® A
        â‡¦ x = [ (Î» y â†’ âŠ¥-elim (x y)) , id ] (M, w âŠ©? A)

      âŠ©K : âˆ€ {w A B} â†’ M , w âŠ© â–¡ (A â† B) â† â–¡ A â† â–¡ B
      âŠ©K {w} {A} {B} = âŠ©â† â‡ Î» x â†’ âŠ©â† â‡ Î» y â†’ âŠ©â–¡ â‡
        Î» {u} wRu â†’ âŠ©MP ((âŠ©â–¡ â‡’ x) wRu) ((âŠ©â–¡ â‡’ y) wRu)


      âŠ©J1 : âˆ€ {w A B} â†’ M , w âŠ© â–¡ (A â† B) â† A â–· B
      âŠ©J1 {w} {A} {B} = âŠ©â† â‡ Î» x â†’ rhd Î» { {u} Rwu â†’ case M, u âŠ©? A of
        Î» { (injâ‚ k) â†’ injâ‚‚ (ï½› u ï½ â¸´ S-quasirefl Rwu â¸´
        Î» {refl â†’ âŠ©MP ((âŠ©â–¡ â‡’ x) Rwu) k})
        ; (injâ‚‚ y) â†’ injâ‚ y}}


      âŠ©J3 : âˆ€ {w A B C} â†’ M , w âŠ© A â–· C âˆ§ B â–· C â† (A âˆ¨ B) â–· C
      âŠ©J3 {w} {A} {B} {C} = âŠ©â† â‡ Î» x â†’ âŠ©â–· â‡ Î» Rwu uAâˆ¨B â†’ case âŠ©âˆ§ â‡’ x of
        Î» {(a â¸´ b) â†’ case âŠ©âˆ¨ â‡’ uAâˆ¨B of
        Î» { (injâ‚ uA) â†’ (âŠ©â–· â‡’ a) Rwu uA ;
        (injâ‚‚ uB) â†’ (âŠ©â–· â‡’ b) Rwu uB} }

      âŠ©J4 : âˆ€ {w A B} â†’ M , w âŠ© A â–· B â† â™¢ A â† â™¢ B
      âŠ©J4 = âŠ©â† â‡ Î» x â†’ âŠ©â† â‡ Î» y â†’ âŠ©â™¢ â‡ (case âŠ©â™¢ â‡’ y of
        Î» { (u â¸´ Rwu â¸´ snd) â†’ case (âŠ©â–· â‡’ x) Rwu snd of
        Î» { (Y â¸´ SwuY â¸´ YB) â†’ case Swu-sat SwuY of
        Î» { (v â¸´ vY) â†’ v â¸´ SwuYâŠ†Rw SwuY vY â¸´ YB vY}}})

      âŠ©J5 : âˆ€ {w A} â†’ M , w âŠ© â™¢ A â–· A
      âŠ©J5 = âŠ©â–· â‡ Î» {u} Rwu uâŠ©â™¢A â†’ case âŠ©â™¢ â‡’ uâŠ©â™¢A of
        Î» { (v â¸´ Ruv â¸´ vA) â†’ ï½› v ï½ â¸´ R-Sw-trans Rwu Ruv
          â¸´ Î» {refl â†’ vA}}

      [âŠ©â–·] : âˆ€ {A B w} {ğ”¸ ğ”¹ : ğ•}
        â†’ (âˆ€ {u} â†’ M , u âŠ© A â‡” u âˆˆ ğ”¸)
        â†’ (âˆ€ {u} â†’ M , u âŠ© B â‡” u âˆˆ ğ”¹)
        â†’ (âˆ€ {u} â†’ R w u â†’ u âˆˆ ğ”¸ â†’ Î£ ğ• Î» V â†’ S w u V Ã— V âŠ† ğ”¹)
        â†’ M , w âŠ© A â–· B
      [âŠ©â–·] [A] [B] Aâ–·B = âŠ©â–· â‡ Î» { {u} Rwu uâŠ©A â†’ case Aâ–·B Rwu ([A] â‡’ uâŠ©A) of
        Î» { (V â¸´ SwuV â¸´ VâŠ†ğ”¹) â†’ V â¸´ SwuV â¸´ (Î» {z â†’ [B] â‡ VâŠ†ğ”¹ z})}}

      module Properties-Trans where

        Trans-4 Trans-7 Trans-8 Trans-3 : Set _
        Trans-4 = âˆ€ {x u Y} â†’ S x u Y â†’ Î£ W Î» y â†’ Î£ (y âˆˆ Y) Î» yâˆˆY â†’ âˆ€ {Y'} â†’ S x y Y' â†’ S x u Y'

        Trans-7 = âˆ€ {u x y Y Y'} â†’ S x u Y â†’ y âˆˆ Y â†’ S x y Y' â†’ y âˆ‰ Y'
          â†’ Î£ ğ• Î» Y'' â†’ Y'' âŠ† Y' Ã— S x u Y''

        Trans-8 = âˆ€ {u x y Y Y'} â†’ S x u Y â†’ y âˆˆ Y â†’ S x y Y' â†’ y âˆ‰ Y' â†’ S x u Y'

        Trans-3 = âˆ€ {x u Y} â†’ S x u Y â†’ Î£ W Î» y â†’ Î£ (y âˆˆ Y) Î» yâˆˆY â†’ âˆ€ {Y'} â†’ S x y Y' â†’ Î£ ğ• Î» Y''
          â†’ Y'' âŠ† Y' Ã— S x u Y''

        4â‡’3 : Trans-4 â†’ Trans-3
        4â‡’3 t SxuY = case t SxuY of Î» { (y â¸´ fstâ‚ â¸´ snd) â†’ y â¸´ fstâ‚ â¸´
          Î» { {Y'} SxyY' â†’ Y' â¸´ (Î» x â†’ x) â¸´ snd SxyY'}}

        âŠ©J2-T3 : âˆ€ {w A B C} â†’ Trans-3 â†’ M , w âŠ© (A â–· B âˆ§ B â–· C) â† A â–· C
        âŠ©J2-T3 {w} {A} {B} {C} t = âŠ©â† â‡ Î» x â†’ âŠ©â–· â‡ Î» {u} Rwu uA â†’ case âŠ©âˆ§ â‡’ x of
            Î» { (Aâ–·B â¸´ Bâ–·C) â†’ case (âŠ©â–· â‡’ Aâ–·B) Rwu uA of
            Î» { (Y â¸´ SwuY â¸´ YB ) â†’ case t SwuY of
            Î» { (y â¸´ yâˆˆY â¸´ snd) â†’ case (âŠ©â–· â‡’ Bâ–·C) (SwuYâŠ†Rw SwuY yâˆˆY) (YB yâˆˆY) of
            Î» { (Y' â¸´ SwyY' â¸´ Y'âŠ©C) â†’ case snd SwyY' of
            Î» { (Y'' â¸´ Y''âŠ†Y' â¸´ SwuY'') â†’ Y'' â¸´ SwuY'' â¸´ Î» {xâ‚ â†’ Y'âŠ©C (Y''âŠ†Y' xâ‚)}}}}}}

        âŠ©J2-T4 : âˆ€ {w A B C} â†’ Trans-4 â†’ M , w âŠ© (A â–· B âˆ§ B â–· C) â† A â–· C
        âŠ©J2-T4 {w} {A} {B} {C} t = âŠ©J2-T3 (4â‡’3 t)

        -- NOTE: you must avoid using S-quasitrans in this proof! this is hacky and
        -- unelegant, but doing it properly would require a lot of work.
        âŠ©J2-T8 : âˆ€ {w A B C} â†’ Trans-8 â†’ M , w âŠ© (A â–· B âˆ§ B â–· C) â† A â–· C
        âŠ©J2-T8 {w} {A} {B} {C} t = âŠ©â† â‡ Î» x â†’ âŠ©â–· â‡ Î» {u} Rwu uA â†’ case âŠ©âˆ§ â‡’ x of
            Î» { (Aâ–·B â¸´ Bâ–·C) â†’ case (âŠ©â–· â‡’ Aâ–·B) Rwu uA of
            Î» { (Y â¸´ SwuY â¸´ YB ) â†’ case M, Y *âŠ©? C of
            Î» { (injâ‚ x) â†’ Y â¸´ SwuY â¸´ Î» {xâ‚ â†’ x xâ‚} ;
            (injâ‚‚ (y â¸´ yâˆˆY â¸´ yâŠ®C)) â†’ case (âŠ©â–· â‡’ Bâ–·C) (SwuYâŠ†Rw SwuY yâˆˆY) (YB yâˆˆY) of
            Î» { (Y' â¸´ SwyY' â¸´ Y'âŠ†C) â†’ Y' â¸´ t SwuY yâˆˆY SwyY' (Î» {yâˆˆY' â†’ âŠ®â†’Â¬âŠ© yâŠ®C (Y'âŠ†C yâˆˆY')}) â¸´
            Î» {xâ‚ â†’ Y'âŠ†C xâ‚}}}}}

  module Extended2
    {â„“W â„“R â„“S}
    {W R S V}
    {M : Model {â„“W} {â„“R} {â„“S} W R S V}
    (M,_*âŠ©?_ : MultiDecidableModel M)
    (âˆˆS? : Decidableâ‚ƒ S)
    (âˆˆSV? : âˆ€ {w u Y} â†’ S w u Y â†’ Decidable Y) where

    infix 5 M,_âŠ©?_
    M,_âŠ©?_ : DecidableModel M
    M,_âŠ©?_ = SingleDecidableModel M,_*âŠ©?_

    open Model M
    open Extended M,_*âŠ©?_ âˆˆS? âˆˆSV?
    open G.Frame F

    L-chain : âˆ€ {w u A} â†’ R w u â†’ M , u âŠ® A â†’ M , w âŠ© â–¡ (â–¡ A â† A) â†’ InfiniteChain R w
    InfiniteChain.b (L-chain {w} {u} Rwu uA uF) = u
    InfiniteChain.a<b (L-chain {w} {u} Rwu uA uF) = Rwu
    InfiniteChain.tail (L-chain {w} {u} Rwu uA uF) =
      case (âŠ©â–¡ â‡’ uF) Rwu of
      Î» { (impl (injâ‚ x)) â†’ case âŠ®â–¡ â‡’ x of
        Î» { (v â¸´ Ruv â¸´ vA) â†’ L-chain Ruv vA ((âŠ©â–¡ â‡’ âŠ©4' uF) Rwu)}
      ; (impl (injâ‚‚ y)) â†’ âŠ¥-elim (âŠ©â†’Â¬âŠ® y uA) }

    âŠ©L : âˆ€ {w A} â†’ M , w âŠ© â–¡ (â–¡ A â† A) â† â–¡ A
    âŠ©L {w} {A} = âŠ©â† â‡ Î» x â†’ âŠ©â–¡ â‡ Î» {u} Rwu â†’ âŠ©â‡”Â¬âŠ® â‡
      Î» Â¬A â†’ R-noetherian (L-chain Rwu Â¬A x)

module _ where
  open PGeneric Trans-conditions.Trans-L
  module ExtendedT2
    {â„“W â„“R â„“S}
    {W R S V}
    {M : Model {â„“W} {â„“R} {â„“S} W R S V}
    (M,_*âŠ©?_ : MultiDecidableModel M)
    (âˆˆS? : Decidableâ‚ƒ S)
    (âˆˆSV? : âˆ€ {w u Y} â†’ S w u Y â†’ Decidable Y)
    where
    open Extended M,_*âŠ©?_ âˆˆS? âˆˆSV?
    open Model M
    open G.Frame F

    âŠ©J2 : âˆ€ {w A B C} â†’ M , w âŠ© (A â–· B âˆ§ B â–· C) â† A â–· C
    âŠ©J2 {w} {A} {B} {C} = âŠ©â† â‡ Î» x â†’ âŠ©â–· â‡ Î» {u} Rwu uA â†’ case âŠ©âˆ§ â‡’ x of
      Î» { (Aâ–·B â¸´ Bâ–·C) â†’ case (âŠ©â–· â‡’ Aâ–·B) Rwu uA of
      Î» { (Y â¸´ SwuY â¸´ YB ) â†’ case M, Y *âŠ©? C of
      Î» { (injâ‚ x) â†’ Y â¸´ SwuY â¸´ Î» { {v} k â†’ x k}
      ; (injâ‚‚ (v â¸´ vâˆˆY â¸´ vÂ¬C)) â†’ case (âŠ©â–· â‡’ Bâ–·C) (SwuYâŠ†Rw SwuY vâˆˆY) (YB vâˆˆY) of
      Î» { (Z â¸´ SwvZ â¸´ ZC) â†’ _ â¸´ let
        f : âˆ€ {y} â†’ y âˆˆ Y â†’ Î£ ğ• Î» Z â†’ S w y Z Ã— Z âŠ† M ,_âŠ© C
        f {y} yâˆˆY = case (âŠ©â–· â‡’ Bâ–·C) (SwuYâŠ†Rw SwuY yâˆˆY) (YB yâˆˆY) of
          Î» { (Zy â¸´ fst â¸´ snd) â†’ Zy â¸´ fst â¸´ Î» {z â†’ snd z}}
        f' : âˆ€ {y} â†’ y âˆˆ Y â†’ Î£ ğ• Î» Z â†’ S w y Z
        f' yâˆˆY = projâ‚ (f yâˆˆY) â¸´ (projâ‚ (projâ‚‚ (f yâˆˆY))) in
        quasitrans SwuY f' â¸´ Î» { {x} (y â¸´ yâˆˆY â¸´ xâˆˆZ) â†’ projâ‚‚ (projâ‚‚ (f yâˆˆY)) xâˆˆZ}}}}}


module _ where
  open PGeneric Trans-conditions.Trans-L public
  open ExtendedT2 public
module SemanticsProperties-4 = PGeneric Trans-conditions.Trans-4
module SemanticsProperties-3 = PGeneric Trans-conditions.Trans-3
module SemanticsProperties-L = PGeneric Trans-conditions.Trans-L
\end{spverbatim}
