\begin{spverbatim}
module GeneralizedFrame.Properties where

open import Agda.Builtin.Nat using (Nat; suc; _+_)
open import Agda.Primitive using (Level; lzero; lsuc; _âŠ”_)
open import Data.Empty using (âŠ¥; âŠ¥-elim)
open import Data.List using (List)
open import Data.List.Relation.Unary.All using (All)
open import Data.Product
open import Data.Sum using (_âŠ_; injâ‚; injâ‚‚)
open import Relation.Nullary using (yes; no; Â¬_)
open import Function using (_âˆ˜_; case_of_; _$_)
open import Relation.Binary using (REL; Rel; Transitive; Reflexive) renaming (Decidable to Decidableâ‚‚)
open import Relation.Binary.PropositionalEquality using (_â‰¡_; _â‰¢_; refl; subst; cong)
open import Relation.Nullary using (Â¬_)
open import Relation.Unary using (Pred; _âˆˆ_; _âˆ‰_; Decidable; ï½›_ï½; _âˆ©_; _âŠ†_; Satisfiable)

open import Formula using (Fm; Var; _â†_; âŠ¥'; _â–·_; var; Â¬'_)
open import Base using (Noetherian; RELâ‚ƒ)


import GeneralizedVeltmanSemantics as G
open import GeneralizedFrame

private
  variable
    â„“W â„“R â„“S : Level

module FrameProperties
    {W R S}
    (T : âˆ€ {â„“W â„“S} (W : Set â„“W) â†’ RELâ‚ƒ W W (Pred W â„“W) â„“S â†’ Set (lsuc â„“W âŠ” â„“S))
    (F : Frame {â„“W} {â„“R} {â„“S} W R S T)
  where
  open Frame F

  SâŠ†ï½›vï½ : âˆ€ {w u v V} â†’ V âŠ† ï½› v ï½ â†’ S w u V â†’ S w u ï½› v ï½
  SâŠ†ï½›vï½ VâŠ†v SwuV = S-ext SwuV VâŠ†v (Î» { refl â†’ case Swu-sat SwuV of
             Î» { (_ , snd) â†’ case VâŠ†v snd of Î» {refl â†’ snd}}})

  SâŠ†ï½›vï½' : âˆ€ {w u k} â†’ âˆƒ[ V ] (V âŠ† ï½› k ï½ Ã— S w u V) â†’ S w u ï½› k ï½
  SâŠ†ï½›vï½' (V , VâŠ†k , SwuV) = SâŠ†ï½›vï½ VâŠ†k SwuV


module FrameLProperties
  {â„“W â„“R â„“S}
  {W R S}
  (F : FrameL {â„“W} {â„“R} {â„“S} W R S)
   where
   open FrameL F

   transUni : âˆ€ {b w x V} â†’ S b w ï½› x ï½ â†’ S b x V â†’ S b w V
   transUni {b} {w} {x} Sbwx SbxV = case quasitrans Sbwx (Î» {refl â†’ _ , SbxV}) of
            Î» {SbwU â†’ S-ext SbwU (Î» { (_ , refl , snd) â†’ snd}) (Î» {k â†’ _ , refl , k})}

   S-trans : âˆ€ {x w u} {V : ğ•} â†’ R x w â†’ R w u â†’ S x u V â†’ S x w V
   S-trans {x} {w} {u} {V} Rxw Rwu = transUni (R-Sw-trans Rxw Rwu)


module Mono-closure
  (W : Set â„“W)
  (R : Rel W â„“R)
  (S : RELâ‚ƒ W W (Pred W â„“W) â„“S) where
  private
    ğ• = Pred W â„“W

  data S' : RELâ‚ƒ W W ğ• (â„“R âŠ” lsuc â„“W âŠ” â„“S) where
    s' : âˆ€ {w u Y Y'} â†’ S w u Y â†’ Y âŠ† Y' â†’ Y' âŠ† R w â†’ S' w u Y'

  S'â†’S : âˆ€ {w u Y'} â†’ S' w u Y' â†’ Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† Y' Ã— Y' âŠ† R w
  S'â†’S (s' {Y = Y} x xâ‚ xâ‚‚) = Y , x , xâ‚ , xâ‚‚

  S'â†’S[Y] : âˆ€ {w u} {Y' : ğ•} â†’ (Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† Y' Ã— Y' âŠ† R w) â†’ ğ•
  S'â†’S[Y] = projâ‚

  S'â†’S[S] : âˆ€ {w u} {Y' : ğ•} â†’ (P : Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† Y' Ã— Y' âŠ† R w) â†’ let Y = projâ‚ P in S w u Y
  S'â†’S[S] = projâ‚ âˆ˜ projâ‚‚

  S'â†’S[âŠ†] : âˆ€ {w u} {Y' : ğ•} â†’ (P : Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† Y' Ã— Y' âŠ† R w) â†’ let Y = projâ‚ P in Y âŠ† Y'
  S'â†’S[âŠ†] = projâ‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚

  S'â†’S[R] : âˆ€ {w u} {Y' : ğ•} â†’ (P : Î£ ğ• Î» Y â†’ S w u Y Ã— Y âŠ† Y' Ã— Y' âŠ† R w) â†’ Y' âŠ† R w
  S'â†’S[R] = projâ‚‚ âˆ˜ projâ‚‚ âˆ˜ projâ‚‚

module Transitivity'
  {W : Set â„“W}
  {R : Rel W â„“R}
  {S : RELâ‚ƒ W W (Pred W â„“W) â„“S}
  where
  ğ• : Set _
  ğ• = Pred W â„“W

  Frame-1 Frame-2 Frame-3 Frame-4 Frame-5 Frame-6 Frame-7 Frame-8
    : Set _
  Frame-1 = Frame W R S (Trans-conditions.Trans-1)
  Frame-2 = Frame W R S (Trans-conditions.Trans-2)
  Frame-3 = Frame W R S (Trans-conditions.Trans-3)
  Frame-4 = Frame W R S (Trans-conditions.Trans-4)
  Frame-5 = Frame W R S (Trans-conditions.Trans-5)
  Frame-6 = Frame W R S (Trans-conditions.Trans-6)
  Frame-7 = Frame W R S (Trans-conditions.Trans-7)
  Frame-8 = Frame W R S (Trans-conditions.Trans-8)

  open Mono-closure W R S

  Frame-1' Frame-2' Frame-3' Frame-4' Frame-5' Frame-6' Frame-7' Frame-8'
    : Set _
  Frame-1' = Frame W R S' (Trans-conditions.Trans-1)
  Frame-2' = Frame W R S' (Trans-conditions.Trans-2)
  Frame-3' = Frame W R S' (Trans-conditions.Trans-3)
  Frame-4' = Frame W R S' (Trans-conditions.Trans-4)
  Frame-5' = Frame W R S' (Trans-conditions.Trans-5)
  Frame-6' = Frame W R S' (Trans-conditions.Trans-6)
  Frame-7' = Frame W R S' (Trans-conditions.Trans-7)
  Frame-8' = Frame W R S' (Trans-conditions.Trans-8)

  lemma : FrameNoTrans W R S â†’ FrameNoTrans W R S'
  lemma (frame witness Swu-sat R-trans R-noetherian SwâŠ†R[w]
    SwuYâŠ†Rw S-quasirefl R-Sw-trans S-ext) =
    frame witness
      (Î» { (s' SwuY YâŠ†Y' Y'âŠ†Rw) â†’ case Swu-sat SwuY of Î» { (fst , snd) â†’ fst , (YâŠ†Y' snd)}})
      R-trans
      R-noetherian
      (Î» { (s' x xâ‚ xâ‚‚) â†’ SwâŠ†R[w] x})
      (Î» { (s' x xâ‚‚ xâ‚ƒ) xâ‚ â†’ xâ‚ƒ xâ‚})
      (Î» x â†’ SâŠ†S' (S-quasirefl x))
      (Î» {x xâ‚ â†’ SâŠ†S' (R-Sw-trans x xâ‚)})
      Î» { (Mono-closure.s' SwxY YâŠ†V VâŠ†R) VâŠ†V' V'âŠ†V â†’
        Mono-closure.s' SwxY (VâŠ†V' âˆ˜ YâŠ†V) (VâŠ†R âˆ˜ V'âŠ†V)}
      where
      SâŠ†S' : âˆ€ {w u Y} â†’ S w u Y â†’ S' w u Y
      SâŠ†S' {w} {u} {Y} x = s' x (Î» z â†’ z) (SwuYâŠ†Rw x)

  S'-âŠ†-Irrel : Set (lsuc â„“W âŠ” â„“R âŠ” â„“S)
  S'-âŠ†-Irrel = âˆ€ {x u Y'} (SxuY' : S' x u Y') â†’
    let Y = S'â†’S[Y] (S'â†’S SxuY')
    in Î£ (Y âŠ† Y') Î» YâŠ†Y' â†’ âˆ€ {y} {yâˆˆY yâˆˆ'Y : y âˆˆ Y} â†’ YâŠ†Y' yâˆˆY â‰¡ YâŠ†Y' yâˆˆ'Y

  1â‡’2' : S'-âŠ†-Irrel â†’ Frame-1 â†’ Frame-2'
  1â‡’2' âŠ†-irrel (frame frame-0 trans) = frame (lemma frame-0)
    Î» { a@(s' {x} {u} {Y} {Y'} SxuY YâŠ† YâŠ†Rx) y'â†’Y' irrel SxyY'y â†’
    case âŠ†-irrel a of Î» { (YâŠ†Y' , irrel') â†’
     case trans SxuY
     (Î» yâˆˆY â†’ S'â†’S[Y] (S'â†’S (SxyY'y (YâŠ†Y' yâˆˆY))))
     (cong (S'â†’S[Y] âˆ˜ S'â†’S âˆ˜ SxyY'y) irrel')
     (Î» yâˆˆY â†’ S'â†’S[S] (S'â†’S (SxyY'y (YâŠ†Y' yâˆˆY)))) of
     Î» { (Z , ZâŠ† , SxuZ) â†’ s' SxuZ
       (Î» { z  â†’ case ZâŠ† z of
       Î» { ((v , vâˆˆY) , snd) â†’
         (v , (YâŠ†Y' vâˆˆY)) , (S'â†’S[âŠ†] (S'â†’S (SxyY'y (YâŠ†Y' vâˆˆY)))) snd }})
       Î» { {v} ((y , yâˆˆY') , vâˆˆY_y) â†’ (S'â†’S[R] (S'â†’S (SxyY'y yâˆˆY'))) vâˆˆY_y}}}}

  2â‡’2' : S'-âŠ†-Irrel â†’ Frame-2 â†’ Frame-2'
  2â‡’2' âŠ†-irrel (frame frame-0 trans) = frame (lemma frame-0)
    Î» { a@(s' {x} {u} {Y} {Y'} SxuY YâŠ† _) y'â†’Y' irrel SxyY'y â†’
    case âŠ†-irrel a of Î» { (YâŠ†Y' , irrel') â†’
     case trans SxuY
     (Î» yâˆˆY â†’ S'â†’S[Y] âˆ˜ S'â†’S âˆ˜ SxyY'y âˆ˜ YâŠ†Y' $ yâˆˆY)
     (cong (S'â†’S[Y] âˆ˜ S'â†’S âˆ˜ SxyY'y) irrel')
     (Î» yâˆˆY â†’ S'â†’S[S] (S'â†’S (SxyY'y (YâŠ†Y' yâˆˆY)))) of
     Î» {Sxuâ‹ƒ â†’ s' Sxuâ‹ƒ
       (Î» { ((v , vâˆˆY) , snd) â†’
         (v , (YâŠ†Y' vâˆˆY)) , (S'â†’S[âŠ†] âˆ˜ S'â†’S âˆ˜ SxyY'y âˆ˜ YâŠ†Y' $ vâˆˆY) snd })
       Î» { {v} ((y , yâˆˆY') , vâˆˆYy) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ SxyY'y $ yâˆˆY') vâˆˆYy}}}}

  3â‡’2' : Frame-3 â†’ Frame-2'
  3â‡’2' (frame frame-0 trans) = frame (lemma frame-0)
    Î» { (s' {x} {u} {Y} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’ case trans SxuY of
    Î» { (yâ‚€ , yâ‚€âˆˆY , snd) â†’ case snd (S'â†’S[S] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) of
    Î» { (Z , ZâŠ† , SxuZ) â†’ s' SxuZ
      (Î» { {v} vâˆˆYy â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , (S'â†’S[âŠ†] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) (ZâŠ† vâˆˆYy)})
    Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}}}}

  4â‡’2' : Frame-4 â†’ Frame-2'
  4â‡’2' (frame frame-0 trans) = frame (lemma frame-0)
    Î» { (s' {x} {u} {Y} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’ case trans SxuY of
    Î» { (yâ‚€ , yâ‚€âˆˆY , snd) â†’ s' (snd (S'â†’S[S] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY))
    (Î» { {v} vâˆˆYy â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , (S'â†’S[âŠ†] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) vâˆˆYy})
    Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}}}

  5â‡’2' : Frame-5 â†’ Frame-2'
  5â‡’2' (frame frame-0 trans) = frame (lemma frame-0)
    Î» { (s' {x} {u} {Y} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’
    case Swu-sat SxuY of Î» { (yâ‚€ , yâ‚€âˆˆY) â†’
    case trans SxuY yâ‚€âˆˆY (S'â†’S[S] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) of
    Î» { (Z , ZâŠ†SxuYyâ‚€ , SxuYyâ‚€) â†’ s' SxuYyâ‚€
    (Î» {âˆˆZ â†’ case ZâŠ†SxuYyâ‚€ âˆˆZ of
    Î» {vâˆˆYy â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , (S'â†’S[âŠ†] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) vâˆˆYy}})
    Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}}}}
    where open FrameNoTrans frame-0

  6â‡’2' : Frame-6 â†’ Frame-2'
  6â‡’2' (frame frame-0 trans) = frame (lemma frame-0)
    Î» { (s' {x} {u} {Y} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’
    case Swu-sat SxuY of Î» { (yâ‚€ , yâ‚€âˆˆY) â†’
    case trans SxuY yâ‚€âˆˆY (S'â†’S[S] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) of
    Î» { SxuYyâ‚€ â†’ s' SxuYyâ‚€
    ((Î» { {v} vâˆˆYy â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , (S'â†’S[âŠ†] âˆ˜ S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY) vâˆˆYy}))
    Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}}}}
    where open FrameNoTrans frame-0

  dec-âŠ† : Set _
  dec-âŠ† = (X Y : ğ•) â†’ X âŠ† Y âŠ (Î£ W Î» x â†’ x âˆˆ X Ã— x âˆ‰ Y)

  7â‡’2' : dec-âŠ† â†’ Frame-7 â†’ Frame-2'
  7â‡’2' âŠ†? (frame frame-0 trans) = frame (lemma frame-0)
    Î» { a@(s' {x} {u} {Y} {Y'} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’
     case âŠ†? Y (â‹ƒ[ Î£ W (_âˆˆ Y') ] (y'â†’Y âˆ˜ projâ‚‚)) of
     Î» { (injâ‚ YâŠ†U) â†’ s' SxuY YâŠ†U
     Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}
     ; (injâ‚‚ (yâ‚€ , yâ‚€âˆˆY , âˆ‰U)) â†’
        let r = S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY in
        case trans SxuY yâ‚€âˆˆY (S'â†’S[S] r)
          (Î» { yâ‚€âˆˆYyâ‚€- â†’ âˆ‰U ((yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , S'â†’S[âŠ†] r yâ‚€âˆˆYyâ‚€-)}) of
          Î» { (Z , ZâŠ† , SxuYyâ‚€) â†’ s' SxuYyâ‚€ (Î» âˆˆY'- â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , S'â†’S[âŠ†] r (ZâŠ† âˆˆY'-))
          (Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd})} }}

  8â‡’2' : dec-âŠ† â†’ Frame-8 â†’ Frame-2'
  8â‡’2' âŠ†? (frame frame-0 trans) = frame (lemma frame-0)
    Î» { a@(s' {x} {u} {Y} {Y'} SxuY YâŠ†Y' _) y'â†’Y irrel y'â†’S' â†’
     case âŠ†? Y (â‹ƒ[ Î£ W (_âˆˆ Y') ] (y'â†’Y âˆ˜ projâ‚‚)) of
     Î» { (injâ‚ YâŠ†U) â†’ s' SxuY YâŠ†U
     Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd}
     ; (injâ‚‚ (yâ‚€ , yâ‚€âˆˆY , âˆ‰U)) â†’
        let r = S'â†’S âˆ˜ y'â†’S' âˆ˜ YâŠ†Y' $ yâ‚€âˆˆY in
        case trans SxuY yâ‚€âˆˆY (S'â†’S[S] r)
          (Î» { yâ‚€âˆˆYyâ‚€- â†’ âˆ‰U ((yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , S'â†’S[âŠ†] r yâ‚€âˆˆYyâ‚€-)}) of
          Î» { SxuYyâ‚€ â†’ s' SxuYyâ‚€ (Î» âˆˆY'- â†’ (yâ‚€ , YâŠ†Y' yâ‚€âˆˆY) , S'â†’S[âŠ†] r âˆˆY'-)
          (Î» { {v} ((y , yâˆˆY') , snd) â†’ (S'â†’S[R] âˆ˜ S'â†’S âˆ˜ y'â†’S' $ yâˆˆY') snd})}}}

module Transitivity {W} {R} {S}
  (F : FrameNoTrans {â„“W} {â„“R} {â„“S} W R S)
  where
  open FrameNoTrans F

  Monotone : Set _
  Monotone = âˆ€ {w u} {V Z : ğ•} â†’ S w u V â†’ V âŠ† Z â†’ Z âŠ† R w â†’ S w u Z

  R-Decidable : Set _
  R-Decidable = Decidableâ‚‚ R

  Sâ‚ƒ-Decidable : Set _
  Sâ‚ƒ-Decidable = âˆ€ {w u Y} â†’ S w u Y â†’ Decidable Y

  open Trans-conditions W S

  ---------------

  1â‡’2 : Monotone â†’ Trans-1 â†’ Trans-2
  --
  2â‡’1 : Trans-2 â†’ Trans-1
  --
  3â‡’4 : Monotone â†’ Trans-3 â†’ Trans-4
  --
  4â‡’3 : Trans-4 â†’ Trans-3
  --
  5â‡’1 : Trans-5 â†’ Trans-1
  5â‡’2 : Monotone â†’ Trans-5 â†’ Trans-2
  5â‡’3 : Trans-5 â†’ Trans-3
  5â‡’4 : Monotone â†’ Trans-5 â†’ Trans-4
  5â‡’6 : Monotone â†’ Trans-5 â†’ Trans-6
  5â‡’7 : Trans-5 â†’ Trans-7
  5â‡’8 : Monotone â†’ Trans-5 â†’ Trans-8
  --
  6â‡’1 : Trans-6 â†’ Trans-1
  6â‡’2 : Monotone â†’ Trans-6 â†’ Trans-2
  6â‡’3 : Trans-6 â†’ Trans-3
  6â‡’4 : Trans-6 â†’ Trans-4
  6â‡’5 : Trans-6 â†’ Trans-5
  6â‡’7 : Trans-6 â†’ Trans-7
  6â‡’8 : Trans-6 â†’ Trans-8
  --
  7â‡’8 : Monotone â†’ Trans-7 â†’ Trans-8
  --
  8â‡’7 : Trans-8 â†’ Trans-7

  ---------------

  1â‡’2 mono t SxuY yâ†’Y irrel p = case t SxuY yâ†’Y irrel p of
    Î» { (Z , ZâŠ† , SxuZ) â†’ mono SxuZ ZâŠ†
    Î» { {v} ((y , yâˆˆY) , snd) â†’ SwuYâŠ†Rw (p yâˆˆY) snd}}

  2â‡’1 t {Y = Y} SxuY yâ†’Y irrel p = â‹ƒ[ Î£ W (_âˆˆ Y) ] (yâ†’Y âˆ˜ projâ‚‚) , (Î» z â†’ z) , t SxuY yâ†’Y irrel p

  3â‡’4 mono t SxuY = case t SxuY of
    Î» { (y , yâˆˆY , snd) â†’ y , yâˆˆY , Î» {SxyY' â†’ case snd SxyY' of
    Î» { (Y'' , Y''âŠ†Y' , SxuY'') â†’ mono SxuY'' Y''âŠ†Y' (Î» { {v} vâˆˆ
    â†’ SwuYâŠ†Rw SxyY' vâˆˆ})}}}

  4â‡’3 t SxuY = case t SxuY of Î» { (y , fstâ‚ , snd) â†’ y , fstâ‚ ,
    Î» { {Y'} SxyY' â†’ Y' , (Î» x â†’ x) , snd SxyY'}}

  -- needs irrel
  -- 2â‡’2L : Trans-2 â†’ Trans-L
  -- 2â‡’2L T2 SxuY f = S-ext (T2 SxuY (Î» { {y} yâˆˆY â†’ projâ‚ (f yâˆˆY)})
  --   (Î» { {y} {a} {b} â†’ {!!} }) Î» {yâˆˆY â†’ projâ‚‚ (f yâˆˆY)})
  --   (Î» { ((x , xâˆˆV) , snd) â†’ _ , xâˆˆV , snd})
  --   Î» { (y , yâˆˆY , snd) â†’ (y , yâˆˆY) , snd}

  2Lâ‡’2 : Trans-L â†’ Trans-2
  2Lâ‡’2 TL SxuY yâ†’Y irrel yâ†’SYy = S-ext
    (TL SxuY Î» {vâˆˆY â†’ _ , yâ†’SYy vâˆˆY})
    (Î» { (y , yâˆˆY , snd) â†’ (y , yâˆˆY) , snd})
    Î» { ((y , yâˆˆY) , snd) â†’ _ , yâˆˆY , snd}

  5â‡’1 t SxuY yâ†’Y irrel p = case Swu-sat SxuY of Î» { (y , yâˆˆY)
    â†’ case t SxuY yâˆˆY (p yâˆˆY) of Î» { (Y' , Y'âŠ†Yy , SxuY') â†’ Y' ,
    (Î» {x â†’ (_ , yâˆˆY) , Y'âŠ†Yy x}) , SxuY'}}

  5â‡’2 mono t SxuY yâ†’Y irrel p = case Swu-sat SxuY of Î» { (y , yâˆˆY)
    â†’ case t SxuY yâˆˆY (p yâˆˆY) of Î» { (Y' , Y'âŠ†Yy , SxuY') â†’
    mono SxuY' (Î» xâ‚ â†’ (y , yâˆˆY) , Y'âŠ†Yy xâ‚)
    (Î» { {v} ((y' , y'âˆˆY) , snd) â†’ SwuYâŠ†Rw (p y'âˆˆY) snd})}}

  5â‡’3 t SxuY = case Swu-sat SxuY of Î» { (y , yâˆˆY) â†’ y , yâˆˆY ,
    Î» {SxyY' â†’ t SxuY yâˆˆY SxyY'}}

  5â‡’4 mono t SxuY = case Swu-sat SxuY of Î» { (y , yâˆˆY) â†’ y , yâˆˆY ,
    Î» {SxyY' â†’ case t SxuY yâˆˆY SxyY' of Î» { (Y'' , Y''âŠ†Y' , SxuY'') â†’
    mono SxuY'' Y''âŠ†Y' (Î» xâ‚ â†’ SwuYâŠ†Rw SxyY' xâ‚)}}}

  5â‡’6 mono t SxuY yâˆˆY SxyY' = case t SxuY yâˆˆY SxyY' of
    Î» { (Y'' , Y''âŠ†Y' , SxuY'') â†’ mono SxuY'' Y''âŠ†Y' Î» { {v} vâˆˆ â†’ SwuYâŠ†Rw SxyY' vâˆˆ}}

  5â‡’7 t SxuY yâˆˆY SxyY' yâˆ‰Y' = t SxuY yâˆˆY SxyY'

  5â‡’8 mono t = 6â‡’8 (5â‡’6 mono t)

  6â‡’1 t = 5â‡’1 (6â‡’5 t)

  6â‡’2 mono t = 1â‡’2 mono (6â‡’1 t)

  6â‡’3 t = 4â‡’3 (6â‡’4 t)

  6â‡’4 t SxuY = case Swu-sat SxuY of
    Î» { (y , yâˆˆY) â†’ y , yâˆˆY , Î» {SxyY' â†’ t SxuY yâˆˆY SxyY'}}

  6â‡’5 t {Y' = Y'} SxuY yâˆˆY SxyY' = Y' , (Î» z â†’ z) , t SxuY yâˆˆY SxyY'

  6â‡’8 t SxuY yâˆˆY SxyY' yâˆ‰Y' = t SxuY yâˆˆY SxyY'

  6â‡’7 x = 8â‡’7 (6â‡’8 x)

  7â‡’8 mono t7 SxuY yâˆˆY SxyY' yâˆ‰Y' = case t7 SxuY yâˆˆY SxyY' yâˆ‰Y'
    of Î» { (Y'' , Y''âŠ†Y' , snd) â†’ mono snd Y''âŠ†Y' (Î» {v} vâˆˆY' â†’ SwuYâŠ†Rw SxyY' vâˆˆY')}

  8â‡’7 t8 {Y' = Y'} SxuY yâˆˆY SxyY' yâˆ‰Y' = Y' , ((Î» xâ‚† â†’ xâ‚†) , t8 SxuY yâˆˆY SxyY' yâˆ‰Y')
\end{spverbatim}
