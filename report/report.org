#+latex_compiler: xelatex
#+latex_class: article
#+options: toc:nil num:nil
#+title: Interpretability logics
#+author: Jan Mas Rovira
#+subtitle: Master's thesis

#+latex_header: \usepackage{unicode-math}
#+latex_header: \usepackage{fontspec}
#+latex_header: \usepackage[x11names, table]{xcolor}
#+latex_header: \usepackage[margin=2.5cm]{geometry}
#+latex_header: \usepackage{lmodern}
#+latex_header: \setmonofont{FreeMono}
#+latex_header: \usepackage{cancel}

#+latex_header: \hypersetup{colorlinks=true,urlcolor=DodgerBlue4,linkcolor=Firebrick4,citecolor=Green4}
#+latex_header: \newcommand{\ie}[0]{i.e.\ }
#+latex_header: \newcommand{\todo}[0]{\textcolor{red}{pending}}
#+latex_header: \newcommand{\red}[1]{\textcolor{red}{#1}}
#+latex_header: \newcommand{\pend}[0]{\textcolor{Tomato3}{pending }}
#+latex_header: \newcommand{\ok}[0]{\textcolor{DeepSkyBlue4}{solved }}

# * Veltman semantics in Agda
# ** Relations in Agda

#    #+begin_example
#    M , w ⊩
#    #+end_example
# ** Veltman Frame
# * Completeness of IL
#   Assume $IL⊬A$, we show that there is a model $M$ and a world $w$ such that $M,w⊩¬A$.
* Frame condition for $ILR_1$
  Some definitions:
  1. $A ◁ C ≔ ¬(A▷¬C)$.
  2. $Rₓ^{-1}[E]≔R^{-1}[E]∩R[x]$. $E$ denotes a set.
  3. $R^{-1}[E] ≔ \{x : ∃y∈E. xRy\}$. $E$ denotes a set.
  4. $[A]_v≔\{x : vRx ⊩ A\}$. $A$ denotes a formula.

  The R1 principle reads as follows:
  \[A ▷ B → (A ◁ C)∧ (D▷♢E)▷B∧□C∧(D▷E)\]

  The R1 condition reads as follows:
  \begin{flalign*}
  &wRxRuS_wV, C∈𝒞(x,u),E⊆R[v] \\
  ⇒ & (∃V'⊆V)(xS_wV',R[V']⊆C,(∀v∈V')(∀c∈C)(vRcSₓRₓ^{-1}[E]⇒cS_vE))
  \end{flalign*}

  *Lemma*
  \[ILR₁⊢R\]


  \newpage
  *Theorem*.
  $$𝔉⊨R₁⇔𝔉⊨(R₁)_{gen}$$

  /proof/.
  # 1. If $𝔉⊭(R₁)_{gen}$ then $𝔉⊬R$ \pend.
  1. Now suppose the $𝔉⊫ (R_1)_{gen}$ and prove that $𝔉⊫R_1$. Let's fix the
     model and let $w ∈ W$ be arbitrary. Suppose $w⊩ A ▷B$, and let $x$ be such
     that $wRx$ and $x⊩ (A ◁ C) ∧ (D ▷ ♢E)$. It follows from $x ⊩A ◁C$ that
     there exists $u$ such that $xRu$, such that $u⊩A$, and for every $Z$ such
     that $uS_x Z$ there is some $c_Z ∈ Z$ such that $c_Z ⊩C$. From $wRu$, $w⊩
     A▷ B$ and $u⊩ A$ follows in particular that there is a $V$, $uS_w V ⊩B$.
     Denote $C ≔ \{c_Z: uS_x Z\}$. Obviously $C ∈ 𝒞(x, u)$. Let $E = [E]_v$. For
     the selected $w, x, u, V, C, E$ the property $(R 1)_{gen}$ implies that
     there exists $V' ⊆ V$ such that:

     \[xS_wV',R[V']⊆C ,(∀v∈V')(∀c∈C)(vRcS_xR_x^{-1}[E]⇒cS_vE)\]

     It is easy to see that $V' ⊩B ∧□ C$. We claim that $V'⊩ D▷ E$. Suppose,
     therefore, that for some $c ∈ R [V']$ we have $c⊩ D$. From earlier we have
     $x⊩ D ▷ ♢E$. Since $c ∈ R [V '] ⊆ C ⊆ R [x]$, then $xRc$ so it follows that
     there exists $U$ such that $cS_x U$ and $U⊩♢E$. Clearly $U⊆[♢E]_x$ and also
     $[♢E]_x$, hence by monotonicity we have $cS_x[♢E]_x$. Then we have $cS_x
     R_x^{−1}[E]$ so we can use the above property and conclude that $cS_v E$.
   \newpage
  2. From $𝔉⊭(R₁)_{gen}$ it follows that there exist $w,x,u,V,C,E$ such that
     $wRxRuS_wV$, $C∈𝒞(x,u)$, $E⊆R^{-1}[W]$ and .

     \[(∀V'⊆V)(xS_wV', R[V']⊆C⇒ (∃v∈V')(∃c∈C)(vRcS_xR_x^{-1}[E], c\cancel{S}_v E))\]

     As $𝔉⊨(R)_{gen}$, there are some $U⊆V$ such that $xS_wU$ and $R[U]⊆C$. Let
     $𝒱$ be the family of all such sets $U$. Therefore, $U∈𝒱$ and the following
     must be valid:
     \[(∃v_U∈U)(∃c_U∈C)(v_URc_US_xR_x^{-1}[E],c_U\cancel{S}_vE)\]

     Let's fix such $v_U$ and $c_U$ for all $U⊆V$ for which $xS_wU$ and $R[U]⊆C$.
     The following applies.
     \begin{flalign*}
     [A]_w &= \{u\} \\
     [B]_w &= V \\
     [C]_w &= C \\
     [D]_w &= \{c_U:U∈𝒱\} \\
     [E]_w &= E
     \end{flalign*}
    (it's always clear from context when $C$ and $E$ are prop letters and when
     sets). It's easy to see that $w ⊩ A ▷ B$ and $x ⊩ A ◁ C$. It is
     easy to see that for $U ∈ 𝒱$ both $U⊩ B ∧ □C$ and ($⋆$) apply: for any set
     $U$, if $xS_wU$ and $U⊩ B ∧ □C$, then $U ∈ 𝒱$ (left side of conjunction: $U
     ⊆ V ⇔ U ⊩ B$; right side: $R [U] ⊆ C ⇔ U ⊩□C$).

     Let us prove $x ⊩ D▷♢E$. Let $xRc⊩ D$. Then $c = c_U$ for some $U ∈ 𝒱$. From
     the definition of $c_U$ we have $c_U S_x R_x^{−1} [E]$, a forcing is defined
     such that $E$ is true exactly on the set $E$. Hence $R_x^{-1}[E]⊩♢E$ and thus
     $x ⊩ D▷♢E$.

     Suppose $xS_w U$ and prove that $U⊮B ∧ □C ∧ (D ▷E)$. If $U⊮B ∧□ C$, we're
     done. Otherwise, from ($⋆$) Follows $U ∈ 𝒱$. From the definition of the world
     $c_U$ we have that $c_U \cancel{S}_v E$. So, $U⊮ D▷ E$.
