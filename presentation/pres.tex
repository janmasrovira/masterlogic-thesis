\documentclass[xcolor={x11names}]{beamer}
\usetheme{Frankfurt}

\usepackage{unicode-math}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{remreset}
\usepackage{mathtools}
\usepackage{latexsym}
\usepackage{cancel}
\usepackage{hyperref}
\usepackage{xspace}
\usepackage{textcomp}
\usepackage{fancyvrb}
\setmonofont{FreeMono}

\usepackage[style=authoryear]{biblatex}
\hypersetup{colorlinks=true,urlcolor=DodgerBlue4,linkcolor=Firebrick4,citecolor=Firebrick4}

% link over the authors as well.
\DeclareCiteCommand{\cite}
{\usebibmacro{prenote}}
{\usebibmacro{citeindex}%
  \printtext[bibhyperref]{\usebibmacro{cite}}}
{\multicitedelim}
{\usebibmacro{postnote}}

% tiny circles without subsections
\makeatletter
\@removefromreset{subsection}{section}
\makeatother
\setcounter{subsection}{1}

\bibliography{refs}


\title{Generalized Veltman Semantics in Agda}
\subtitle{Master's thesis \\ {\scriptsize Master in Pure and Applied Logic}}
\author[Mas]{Jan Mas Rovira\inst{1} \\[1ex] {\footnotesize Supervisors:  Joost J.
    Joosten\inst{1} \and Luka Mikec\inst{2}}}
\institute[UB, UZ]{\inst{1} Universitat de Barcelona \and
  \inst{2} University of Zagreb}
\date[Nov 2020]{November 27th 2020}
\titlegraphic{ \includegraphics[width=4cm]{img/ub-logo.pdf}}

\newcommand{\prin}[1]{\ensuremath{\textbf{\textup{#1}}}\xspace}
\newcommand{\il}{\prin{IL}}
\newcommand{\ilm}{\prin{ILM}}
\newcommand{\ilall}[0]{\ensuremath{\mathsf{IL}}(All)}
\newcommand{\gl}{\prin{GL}}
\newcommand{\zf}{\prin{ZF}}
\newcommand{\ch}{\prin{CH}}
\newcommand{\veql}{\prin{(V=L)}}
\newcommand{\rn}{\ensuremath{\prin{R}^n}\xspace}
\newcommand{\rsn}{\ensuremath{\prin{R}_n}\xspace}
\newcommand{\principle}[1]{\text{$\mathsf{#1}$}}
\renewcommand{\sf}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\kgen}[1]{\text{($\mathsf{#1}$)\textsubscript{gen}}}
\newcommand{\kord}[1]{\text{($\mathsf{#1}$)}}

\begin{document}

\frame{\titlepage}

\section{Introduction}
\begin{frame}
  \frametitle{Introduction}
  \begin{itemize}
  \item Agda is a \textbf{proof assistant} based on dependent type theory.
    \break{} \pause{}
  \item Veltman semantics are a kind of relational semantics (Ã  la
    Kripke) for \textbf{interpretability logics}:
    \begin{itemize}
    \item Ordinary Veltman semantics.
    \item Generalized Veltman semantics.
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Examples of interpretations}
  Examples of interpretations (\cite{visser1997overview}):
  \pause{}
  \vspace{0.4cm}
  \begin{itemize}
  \item The interpretation of arithmetic in set theory.
    \pause{}
  \item GÃ¶del's interpretation of $\zf+\veql$ in \zf{}
       shows consistency of \zf{} + \ch{} w.r.t. \zf{}.
    \pause{}
  \item The interpretation of elementary syntax in arithmetic. Important for
    GÃ¶del's incompleteness theorems.
  \end{itemize}
\end{frame}

\section{Interpretability Logics}
\begin{frame}
  \frametitle{Interpretability Logics}
  In the logic of provability \gl{} we have that:
  \begin{itemize}
    \item $â–¡A$ means ``A is provable''.
    \item $â™¢A$ means ``A is consistent''. Note that $â™¢A=Â¬â–¡Â¬A$.
  \end{itemize}
  The aim of \gl{} is to describe and prove the structural behaviour of the
  provability predicate.

  \pause{}\vspace{0.2cm}

  Interpretability logics extend the provability logic \gl. The language is
  $âŸ¨â†’,âŠ¥,â–¡,â–·âŸ©$ and we can define $â™¢,âˆ§,âˆ¨$ in the usual way.
  \begin{itemize}
  \item $Aâ–·B$ means ``T + A* interprets T + B*''.
  \end{itemize}
  Given a reasonable arithmetical theory $\prin{T}$ the aim is to find the logic
  $\prin{IL(T)}$ which describes the structural behaviour of its
  interpretability predicate.
  \[\prin{IL(T)}âŠ¢Aâ‡” \prin{T}âŠ¢A^*\text{, for any realization *.} \]

\end{frame}

\begin{frame}
  \frametitle{Arithmetical realization}
  Given an arithmetical theory $\prin{T}$ with language $â„’$, an arithmetical
  realization $*$ is a map from interpretability formulas to $â„’$-sentences such that:
  \begin{itemize}
    \item $p^*$ is a sentence of $â„’$;
    \item $âŠ¥^*$ is $0=1$;
    \item $(A \to B)^* = A^* \to B^*$;
    \item $(A \rhd B)^* = \mathsf{Int}_{\prin{T}}(\ulcorner A^* \urcorner, \ulcorner B^*\urcorner)$;
    \item $(â–¡A)^* = \mathsf{Prov}_{\prin{T}}(\ulcorner A^* \urcorner)$.
  \end{itemize}

  % Note that it suffices to set the behaviour of the realization for
  % propositional variables.
  %   \pause{}
  %   We are concerned with interpretability with respect to some theory $T$.
  %   \[T+Aâ–·T+B\]
\end{frame}

\begin{frame}
  \frametitle{Logic \il}
  The logic \il{} is contained in almost all interpretability logics.

  \vspace{0.3cm} The rules are modus ponens and necessitation. It has all the
  theorems of \gl{} plus the following axioms schemes: \pause{}

  % In particular, you should add a pair of brackets in J3 and two in J2, on in
  % J4 (weâ€™re not type-theorists)
  \begin{itemize}
  \item J1: $â–¡ (A â†’ B) â†’ (A â–· B)$;
    \pause{}
  \item J2: $(A â–· B) âˆ§ (B â–· C) â†’ (A â–· C)$;
    \pause{}
  \item J3: $(A â–· C) âˆ§ (B â–· C) â†’ (A âˆ¨ B) â–· C$;
    \pause{}
  \item J4: $(A â–· B) â†’ (â™¢ A â†’ â™¢ B)$;
    \pause{}
  \item J5: $â™¢ A â–· A$.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Logic \ilm}

  The logic ILM is defined as \il + \prin{M}, where
  \[\prin{M}â‰” A â–· B â†’ (A âˆ§ â–¡ C) â–· (B âˆ§ â–¡ C).\]

  The theorems of $\textsf{ILM}$ are the set of interpretability principles that
  are always provable in theories which are $Î£_1$ sound and have full induction.
  An example of such a theory is $\textsf{PA}$, thus $\prin{IL(PA)}=\ilm$
  (\cite{berarducci1990interpretability,shavrukov1988logic}).

  % TODO MISSING REFERENCE

\end{frame}

\section{Semantics and frame conditions}
\begin{frame}
  \frametitle{Generalized Veltman Semantics (Verbrugge 1992)}
  A \textbf{generalized Veltman frame} (GVF) is a tuple $âŸ¨W,R,\{S_w:wâˆˆW\}âŸ©$ with
  $RâŠ†WÃ—W$ and $S_wâŠ†WÃ—(ğ’«(W)âˆ–\{âˆ…\})$.\\ We write $uS_wY$ instead of $âŸ¨u,YâŸ©âˆˆS_w$.
  \begin{itemize}
    \item $R$ is transitive and conversely well-founded;
    \item if $uS_wY$ then $wRu$ and $\{v:wRv\}âŠ†Y$;
    \item if $wRu$ then $uS_w\{u\}$;
    \item if $wRuRv$ then $uS_w\{v\}$;
    \item if $uS_wY$ and for all $yâˆˆY$ we have $yS_wZ_y$ then $uS_w\left(â‹ƒ_{yâˆˆY}Z_y\right)$.
  \end{itemize}

  \pause{}
  \vspace{0.3cm}
  A \textbf{generalized Veltman model} (GVM) is a tuple $âŸ¨W,R,S,VâŸ©$ where
  $âŸ¨W,R,SâŸ©$ is a GVF and $VâŠ†WÃ—Var$ is a valuation.

  \vspace{0.2cm}
  Soundness and completeness w.r.t to \il.
\end{frame}

\begin{frame}
  \frametitle{Generalized Veltman Semantics}
  Given a GVM $âŸ¨W,R,S,VâŸ©$ we define $âŠ©\ âŠ†WÃ—\sf{Fm}$ as follows:
  \begin{itemize}
    \item $wâŠ®âŠ¥$;
    \item $wâŠ©p$ iff $âŸ¨w,pâŸ©âˆˆV$;
    \item $wâŠ©Aâ†’B$ iff $wâŠ©A$ implies $wâŠ©B$;
    \item $wâŠ©â–¡A$ iff for all $u$ such that $wRu$ we have $uâŠ©A$;
    % \item $wâŠ©â™¢A$ iff there is some $u$ such that $wRu$ and $uâŠ©A$;
      \pause{}
    \item $wâŠ©Aâ–·B$ iff $wRu$ and $uâŠ©A$ implies that there exists some $Y$ such
      that $uS_wY$ and for all $yâˆˆY$ we have $yâŠ©B$.
  \end{itemize}
  \begin{figure}[t]
    \includegraphics[scale=0.8]{img/ArhdB-gen}
    \centering
  \end{figure}
\end{frame}


\begin{frame}
  \frametitle{Generalized frames revisited}

  A \textbf{generalized Veltman frame} (GVF) is a tuple $âŸ¨W,R,\{S_w:wâˆˆW\}âŸ©$ with
  $RâŠ†WÃ—W$ and $S_wâŠ†WÃ—(ğ’«(W)âˆ–\{âˆ…\})$.\\ We write $uS_wY$ instead of $âŸ¨u,YâŸ©âˆˆS_w$.
  \begin{itemize}
  \item $R$ is transitive and conversely well-founded;
  \item if $uS_wY$ then $wRu$ and $\{v:wRv\}âŠ†Y$;
  \item if $wRu$ then $uS_w\{u\}$;
  \item if $wRuRv$ then $uS_w\{v\}$;
  \item \color{red} quasi-transitivity: if $uS_wY$ and for all $yâˆˆY$ we have
    $yS_wZ_y$ then $uS_w\left(â‹ƒ_{yâˆˆY}Z_y\right)$.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Quasi-transitivity conditions in the literature}
  \begin{table}[H]
    \centering
    \small
    \begin{tabular}{c|l}
      Nr. & Semantic requirement for quasi-transitivity\\
      \hline
      \label{cond:1}1 & \(uS_xY â‡’ âˆ€ \, \{ Z_y\}_{yâˆˆ Y} \Big((âˆ€\, yâˆˆY\ yS_xZ_y) â‡’ âˆƒ VâŠ† â‹ƒ_{yâˆˆ Y}Z_y âˆ§ uS_xV\Big)\)\\
      \label{cond:2}2 & \(uS_xY â‡’ âˆ€ \, \{ Z_y\}_{yâˆˆ Y} \Big((âˆ€\, yâˆˆY\ yS_xZ_y) â‡’ uS_xâ‹ƒ_{yâˆˆ Y}Z_y\Big)\)\\
      \label{cond:3}3 & \(uS_xY â‡’ âˆƒ\, yâˆˆY\, âˆ€ Y'(yS_xY' â‡’ âˆƒ \, Y''{âŠ†}Y' âˆ§ uS_xY'')\)\\
      \label{cond:4}4 & \(uS_xY â‡’ âˆƒ\, yâˆˆY\, âˆ€ Y'(yS_xY' â‡’ uS_xY')\)\\
      \label{cond:5}5 & \(uS_xY â‡’ âˆ€\, yâˆˆY\, âˆ€ Y'(yS_xY' â‡’ âˆƒ \, Y''{âŠ†}Y' âˆ§ uS_xY'')\)\\
      \label{cond:6}6 & \(uS_xY â‡’ âˆ€\, yâˆˆY\, âˆ€ Y'(yS_xY' â‡’ uS_xY')\)\\
      \label{cond:7}7 & \(uS_xY â‡’ âˆ€\, yâˆˆY\, âˆ€ Y'(yS_xY'\wedge yâˆ‰Y' â‡’ âˆƒ \, Y''{âŠ†}Y'\ uS_xY'')\)\\
      \label{cond:8}8 & \(uS_xY â‡’ âˆ€\, yâˆˆY\, âˆ€ Y'(yS_xY'\wedge yâˆ‰Y' â‡’ uS_xY')\)\\
    \end{tabular}
  \end{table}
\end{frame}

\begin{frame}
  \frametitle{Generalized frames revisited}

  A \textbf{generalized Veltman frame} (GVF) is a tuple $âŸ¨W,R,\{S_w:wâˆˆW\}âŸ©$ with
  $RâŠ†WÃ—W$ and $S_wâŠ†WÃ—(ğ’«(W)âˆ–\{âˆ…\})$.\\ We write $uS_wY$ instead of $âŸ¨u,YâŸ©âˆˆS_w$.
  \begin{itemize}
  \item $R$ is transitive and conversely well-founded;
  \item if $uS_wY$ then $wRu$ and $\{v:wRv\}âŠ†Y$;
  \item if $wRu$ then $uS_w\{u\}$;
  \item if $wRuRv$ then $uS_w\{v\}$;
  \item if $uS_wY$ and for all $yâˆˆY$ we have
    $yS_wZ_y$ then $uS_w\left(â‹ƒ_{yâˆˆY}Z_y\right)$;
  \item \color{blue} Monotonicity: if $uS_wVâŠ†ZâŠ†\{u:wRu\}$ then $uS_wZ$.
  \end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Quasi-transitivity conditions in the literature}

  \begin{figure}[t]
    \includegraphics[scale=0.8]{img/trans-impl}
    \centering
  \end{figure}
\end{frame}


\begin{frame}
  \frametitle{Frame conditions}
  Given any principle \sf{X} we say that a first order (or higher order) formula
  $\kgen{X}$ is the \textbf{frame condition} for \sf{X} if for any GVF $F$ we have
  \[FâŠ¨\kgen{X}â‡”FâŠ©\sf{X},\]
  where $FâŠ©\sf{X}$ iff $âŸ¨F,VâŸ©âŠ©\sf{X}$ for any valuation $V$.
  \pause{}

  \vspace{0.7cm}

  Example: The frame condition $\kgen{M}$ is
  \[ âˆ€wâˆ€xâˆ€V(xS_wVâ‡’ âˆƒV'âŠ†V(xS_wV',âˆ€v'âˆˆV'âˆ€z(v'Rzâ‡’xRz))).\]
\end{frame}

\begin{frame}
  \frametitle{\prin{IL(All)} and the series of principles \rn and \rsn}
  The logic \ilall{} is the intersection of interpretability
  logics of all reasonable arithmetical theories.

  \pause{}

  The best known lower bound for \ilall{} is $\prin{ILWR}^n\prin{R}_n$.

  The series of principles \rn{} and \rsn{} are due to~\cite{two-new-series}.

  \vspace{0.2cm}
  Definition of $\rn$:
  \begin{flalign*}
    U_0 &â‰” â™¢Â¬(D_0â–·Â¬C) \\
    U_{r+1} &â‰” â™¢((Dáµ£â–·D_{r+1}) âˆ§ Uáµ£) \\
    Râ°& â‰” A â–· B â†’ Â¬ (A â–· Â¬ C) â–· B âˆ§ â–¡ C \\
    R^{n+1}& â‰” A â–· B â†’ ((D_{n}â–·A) âˆ§ U_{n}) â–· B âˆ§ â–¡ C
  \end{flalign*}

  \pause{}
  We have found frame conditions for generalized Veltman semantics for $R^n$ and
  $R_1$. The proofs have been formalized in Agda.
\end{frame}
\begin{frame}
  \frametitle{Frame conditions}
  We have verified the following frame conditions:

  \textbf{Ordinary Semantics}: $\principle{M}$,
  $\principle{P_0}$, $\principle{R}$, $\principle{M_0}$

  \textbf{Generalized Semantics}: $\principle{M}$, $\principle{P_0}$,
  $\principle{R}$, $\principle{M_0}$, $\principle{R^n}$, $\principle{R_1}$.
\end{frame}




\begin{frame}
  \frametitle{Ordinary vs Generalized}
  Can we transform ordinary models to generalized models and viceversa while
  preserving modal theoremhood?
  \pause{}
  \begin{itemize}
  \item Ordinary $â‡’$ Generalized \textcolor{Chartreuse4}{$(\checkmark)$}
    \break{} \pause{}
    \item Generalized [3,4,5,6] $â‡’$ Ordinary
      \textcolor{Chartreuse4}{$(\checkmark)$} (Verbrugge, Mikec) \break{} \pause{}
    \item Generalized [1,2] $â‡’$ Ordinary \textcolor{DarkGoldenrod3}{(?)} (VukoviÄ‡)
  \end{itemize}
\end{frame}

\section{Agda formalization}
\begin{frame}[fragile]
  \frametitle{Agda}
  Agda is a \textbf{proof assistant} based on an extension of Martin LÃ¶f's
  logical framework.

  \vspace{0.3cm}
  \pause{}
  Papers that use Agda (\textasciitilde{}200):

  \begin{itemize}
  \item \href{https://wiki.portal.chalmers.se/agda/Main/PapersUsingAgda}{wiki.portal.chalmers.se/agda/Main/PapersUsingAgda}

  \item \href{https://researchr.org/bibliography/agda-papers/publications}{researchr.org/bibliography/agda-papers/publications}
  \end{itemize}

  \pause{}

  \vspace{0.3cm}
  How we prove things in Agda?
  \begin{itemize}
  \item The \textcolor{blue}{type} expresses the \textcolor{blue}{property}.
  \item The \textcolor{red}{term} is a constructive \textcolor{red}{proof}.
  \end{itemize}

\end{frame}

% \begin{frame}[fragile]
%   \frametitle{Agda theorem example}
%   Given any GVM $M=âŸ¨W,R,S,VâŸ©$, world $uâˆˆW$ and formulas $A$, $B$ we have that:
%   \[M,uâŠ©â–¡ (A â†’ B) â†’ A â–· B.\]
%   \pause{}
%   The property as an Agda type:
% \begin{verbatim}
%   âˆ€ {W R S V}
%     {M : Model W R S V}
%     {u : W}
%     {A B : Fm}
%    â†’
%     M , u âŠ© â–¡ (A â† B) â† A â–· B
% \end{verbatim}
% \end{frame}

% \begin{frame}
%   \frametitle{Agda formalization}
%   Our Agda library includes (\textasciitilde{} 5k lines of code):
%   \begin{itemize}
%   \item Definition of ordinary and generalized Veltman Semantics.
%   \item Definition of logic IL and proof of soundness for all semantics.
%   \item Many of the relevant interpretability principles in conjunction with
%     their proven frame conditions. These include $\principle{M}$,
%     $\principle{P_0}$, $\principle{R}$, $\principle{M_0}$ for both semantics and
%     $\principle{R^n}$, $\principle{R_1}$ for generalized semantics.
%   \item Analysis of quasi-transitivity properties for generalized Veltman
%     semantics.
%   \item Verified transformations between ordinary and generalized models that
%     preserve modal theorems.
%   \item A verified embedded domain specific language for Hilbert style proofs
%     for the logic \il.
%   \end{itemize}
% \end{frame}

\begin{frame}[fragile]
  \frametitle{\il{} in Agda}

\begin{Verbatim}[fontsize=\footnotesize]
data _âŠ¢_ (Î  : List Fm) : Fm â†’ Set where
  -- classical axioms
  C1 : âˆ€ {A B} â†’   Î  âŠ¢ A â† (B â† A)
  C2 : âˆ€ {A B C} â†’ Î  âŠ¢ (A â† (B â† C)) â† ((A â† B) â† (A â† C))
  C3 : âˆ€ {A B} â†’   Î  âŠ¢ (Â¬' A â† Â¬' B) â† (B â† A)
  -- GL axioms
  K : âˆ€ {A B} â†’    Î  âŠ¢ (â–¡ (A â† B)) â† (â–¡ A â† â–¡ B)
  L : âˆ€ {A} â†’      Î  âŠ¢ â–¡ (â–¡ A â† A) â† â–¡ A
  -- IL axioms
  J1 : âˆ€ {A B} â†’   Î  âŠ¢ â–¡ (A â† B) â† A â–· B
  J2 : âˆ€ {A B C} â†’ Î  âŠ¢ A â–· B âˆ§ B â–· C â† A â–· C
  J3 : âˆ€ {A B C} â†’ Î  âŠ¢ (A â–· C âˆ§ B â–· C) â† (A âˆ¨ B) â–· C
  J4 : âˆ€ {A B} â†’   Î  âŠ¢ A â–· B â† â™¢ A â† â™¢ B
  J5 : âˆ€ {A} â†’     Î  âŠ¢ â™¢ A â–· A
  -- rules
  MP : âˆ€ {A B} â†’ Î  âŠ¢ A â† B â†’ Î  âŠ¢ A â†’ Î  âŠ¢ B
  nec : âˆ€ {A} â†’ [] âŠ¢ A â†’ Î  âŠ¢ â–¡ A
  Ax : âˆ€ {A} â†’ A âˆˆ Î  â†’ Î  âŠ¢ A
\end{Verbatim}
\end{frame}
\begin{frame}[fragile]
  \frametitle{\il{} derivation in Agda}
  How do we prove $âŠ¢_{\il{}}Aâ†’A$ in Agda? \break\pause{}

  Everything explicit:
  \begin{verbatim}
  Aâ†A : âˆ€ {Î  A} â†’ Î  âŠ¢ A â† A
  Aâ†A {Î } {A} = MP (MP (C2 {Î } {A} {A â† A} {A})
                 (C1 {Î } {A} {A â† A})) (C1 {Î } {A} {A})
  \end{verbatim}
\pause{}

  We can rely on type inference:
\begin{verbatim}
  âŠ¢Aâ†A' : âˆ€ {A Î } â†’ Î  âŠ¢ A â† A
  âŠ¢Aâ†A' {A} = MP (MP C2 C1) (C1 {B = A})
\end{verbatim}
  Still we do not see the intermediate steps!

\end{frame}
\begin{frame}[fragile]
  \frametitle{Hilbert style proofs in Agda}

  Let us show $âŠ¢_{\il}Aâ–·A$ using our language.
  \pause{}
  \vspace{0.6cm}
\begin{semiverbatim}
âŠ¢Aâ–·A : \{A : Fm\} â†’ [] âŠ¢ A â–· A
\uncover<3->{âŠ¢Aâ–·A \{A\} =
  begin[ 0 ] A â† A                 By âŠ¢Aâ†A}
\uncover<4->{       [ 1 ] â–¡ (A â† A)             ByNec 0}
\uncover<5->{       [ 2 ] â–¡ (A â† A) â† (A â–· A)   By J1}
\uncover<6->{       [ 3 ] A â–· A                 ByMP 2 , 1
       â– }
\end{semiverbatim}
\end{frame}

\begin{frame}
  \frametitle{Live}
  \centering \Huge Live demonstration
\end{frame}


\begin{frame}
  \frametitle{Open source}
  \centering
  \href{https://gitlab.com/janmasrovira/interpretability-logics}{gitlab.com/janmasrovira/interpretability-logics}
\end{frame}

\begin{frame}
  \frametitle{Personal experience}
  \centering \large My experience after 11 months working on this thesis:
  \\~\\
  \begin{itemize}
  \item I was part of two publications. I presented a short paper in AiML 2020
    (Helsinki). \break{} \pause{}
  \item Agda is difficult but rewarding. Our library has \textasciitilde{}5K
    lines of code. \break{} \pause{}

  \item \textbf{Joost and Luka are great supervisors!}
  \end{itemize}
\end{frame}


\begin{frame}
  \centering \Huge Thank you!
\end{frame}

\begin{frame}[allowframebreaks]
  \frametitle{References}
  \nocite{joosten2020overview}
  \nocite{Verbrugge}
  \printbibliography{}
\end{frame}

\end{document}